<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Tkestack â€“ TKEStack</title><link>/web/</link><description>Recent content in TKEStack on Tkestack</description><generator>Hugo -- gohugo.io</generator><atom:link href="/web/index.xml" rel="self" type="application/rss+xml"/><item><title>Blog: Upgrade TKEStack with tke-installer</title><link>/web/blog/2021/09/30/upgrade-tkestack/</link><pubDate>Thu, 30 Sep 2021 00:00:00 +0000</pubDate><guid>/web/blog/2021/09/30/upgrade-tkestack/</guid><description>
&lt;p>&lt;strong>Author&lt;/strong>: LeoRyu&lt;/p>
&lt;p>&lt;em>This paper will introduce how to upgrade TKEStack with tke-installer.&lt;/em>&lt;/p>
&lt;h2 id="limitations">Limitations&lt;/h2>
&lt;ol>
&lt;li>TKEStack version &amp;gt;= 1.5.0&lt;/li>
&lt;li>Cannot skip minor version, e.g., cannot upgrade from v1.5.x to v1.7.x&lt;/li>
&lt;li>make sure your global cluster node have enough disk space, &amp;gt; 40GB is recommended&lt;/li>
&lt;li>If upgrade from v1.7.x to v1.8.x, you should migrate container runtime from docker to containerd before upgrade, check &lt;a href="https://tkestack.github.io/web/zh/blog/2021/09/01/container-runtime-migraion/">https://tkestack.github.io/web/zh/blog/2021/09/01/container-runtime-migraion/&lt;/a>&lt;/li>
&lt;/ol>
&lt;h2 id="upgrade-process">Upgrade Process&lt;/h2>
&lt;h3 id="download-target-version-tke-installer">Download target version tke-installer&lt;/h3>
&lt;p>Download tke-installer with version you want to upgrade to in &lt;code>global&lt;/code> cluster node.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#000">arch&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>amd64 &lt;span style="color:#000">version&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">={&lt;/span>version you want to upgrade to&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> wget https://tke-release-1251707795.cos.ap-guangzhou.myqcloud.com/tke-installer-linux-&lt;span style="color:#000">$arch&lt;/span>-&lt;span style="color:#000">$version&lt;/span>.run&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>,.sha256&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> sha256sum --check --status tke-installer-linux-&lt;span style="color:#000">$arch&lt;/span>-&lt;span style="color:#000">$version&lt;/span>.run.sha256 &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> chmod +x tke-installer-linux-&lt;span style="color:#000">$arch&lt;/span>-&lt;span style="color:#000">$version&lt;/span>.run
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="prepare-credential">Prepare credential&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># set kubeconfig&lt;/span>
mkdir -p /opt/tke-installer/conf &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> mkdir -p /opt/tke-installer/data &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> cp ~/.kube/config /opt/tke-installer/conf/kubeconfig
&lt;span style="color:#8f5902;font-style:italic"># set registry ca cert&lt;/span>
kubectl &lt;span style="color:#204a87">exec&lt;/span> -n tke tke-registry-api-&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>your registry api hash&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span> cat certs/ca.crt &amp;gt; /opt/tke-installer/data/ca.crt
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="upgrade-through-tke-installer">Upgrade through tke-installer&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">./tke-installer-linux-amd64-&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>version you want to upgrade to&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>.run --upgrade
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="check-upgrade-log">Check upgrade log&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">tail -f /opt/tke-installer/data/tke.log
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This log file will log upgrade process until you get &lt;code>===&amp;gt;upgrade task [Sucesss]&lt;/code>.&lt;/p></description></item></channel></rss>