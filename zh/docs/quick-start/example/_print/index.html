<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/web/zh/docs/quick-start/example/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>入门示例 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="入门示例"><meta property="og:description" content="入门示例
"><meta property="og:type" content="website"><meta property="og:url" content="/web/zh/docs/quick-start/example/"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="入门示例"><meta itemprop=description content="入门示例
"><meta name=twitter:card content="summary"><meta name=twitter:title content="入门示例"><meta name=twitter:description content="入门示例
"><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/web/zh/docs/quick-start/example/>返回本页常规视图</a>.</p></div><h1 class=title>入门示例</h1><div class=lead>入门示例</div><ul><li>1: <a href=#pg-fab69c9d83a9da61b39c006b88f3929a>创建nginx服务</a></li><li>2: <a href=#pg-9a2a5aa9bc2d08d259f1ad9a976eb560>编写HelloWorld程序</a></li><li>3: <a href=#pg-d2fc2e9c475dda096ccff56f6718d569>如何构建Docker镜像</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-fab69c9d83a9da61b39c006b88f3929a>1 - 创建nginx服务</h1><div class=lead>创建nginx服务</div><p>本文档旨在帮助大家了解如何快速创建一个容器集群内的 nginx 服务。</p><h2 id=前提条件>前提条件</h2><blockquote><ul><li>已部署 <a href=../../../installation/environment-requirement>TKEStack 控制台</a>。</li><li>已创建集群。如没有另外创建集群，可以先使用global集群。如要尝试创建新集群，请参见 <a href=../../../user-guide/platform-console/cluster-mgmt>创建集群</a>。</li></ul></blockquote><h2 id=操作步骤>操作步骤</h2><h3 id=创建-nginx-服务>创建 Nginx 服务</h3><ol><li>登录TKEStack 控制台 。</li></ol><p><img src=../../../../images/nginx-0.png alt></p><ol><li>单击左侧导航栏中【集群管理】，进入“集群管理”页面，单击需要创建服务的集群 ID。</li></ol><p><img src=../../../../images/nginx-1.png alt></p><ol><li>进入【工作负载】的【 Deployment 】中，选择【新建】。如下图所示：</li></ol><p><img src=../../../../images/nginx-2%20%281%29%20%281%29%20%282%29.png alt></p><ol><li>在“新建Workload”页面，只需输入下图中红框的参数即可。</li></ol><p><img src=../../../../images/nginx-2%20%281%29%20%281%29.png alt></p><p><img src=../../../../images/nginx-3.png alt></p><p><img src=../../../../images/nginx-4.png alt></p><blockquote><p>注意：服务所在集群的安全组需要放通节点网络及容器网络，同时需要放通30000 - 32768端口，否则可能会出现容器服务无法使用问题。</p></blockquote><ol><li>单击上图中的【创建Workload】，完成创建。如下图所示：</li></ol><blockquote><p>注意：当运行/期望Pod数量一致时，负载完成创建。</p></blockquote><p><img src=../../../../images/nginx-5.png alt></p><ol><li>如果在第5步中有创建Service，则可以在【服务】下的【Service】看到与刚刚创建的Deployment同名的Service</li></ol><p><img src=../../../../images/nginx-6.png alt></p><h3 id=访问-nginx-服务>访问 Nginx 服务</h3><p>可通过以下两种方式访问 nginx 服务。</p><h4 id=通过主机节点端口访问-nginx-服务>通过主机节点端口访问 nginx 服务</h4><p>在本地主机的浏览器地址栏输入<code>集群任意节点IP:30000 端口</code>，例如<code>10.0.0.1:30000</code>即可访问服务。如果服务创建成功，访问服务时直接进入 nginx 服务器的默认欢迎页。如下图所示：</p><blockquote><p>注意：如果本地主机在集群内网中，输入节点的内网IP地址即可；如果本地主机不在集群内网中，需要输入节点的外网IP地址</p></blockquote><p><img src=https://main.qcloudimg.com/raw/37246241fe0abd1d3796c080b1661217.png alt></p><h4 id=通过服务名称访问-nginx-服务>通过服务名称访问 nginx 服务</h4><p>集群内的其他服务或容器可以直接通过服务名称访问。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9a2a5aa9bc2d08d259f1ad9a976eb560>2 - 编写HelloWorld程序</h1><div class=lead>编写HelloWorld程序</div><h2 id=操作场景>操作场景</h2><p>本文档旨在帮助大家了解如何快速创建一个容器集群内的 Hello World 的 Node.js 版的服务。</p><h2 id=前提条件>前提条件</h2><ul><li>已部署 <a href=../../../installation/environment-requirement>TKEStack 控制台</a>。</li><li>已创建集群。如没有另外创建集群，可以先使用global集群。如要尝试创建新集群，请参见 <a href=../../../user-guide/platform-console/cluster-mgmt>创建集群</a>。</li></ul><h2 id=操作步骤>操作步骤</h2><h3 id=编写代码制作镜像>编写代码制作镜像</h3><h4 id=编写应用程序>编写应用程序</h4><p>以CentOS 7.6为例</p><ol><li><p>安装node.js，然后依次执行以下命令，创建并进入 hellonode 的文件夹。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>yum install -y nodejs
mkdir hellonode
cd hellonode/
</code></pre></div></li><li><p>执行以下命令，新建并打开 server.js 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>vim server.js
</code></pre></div></li><li><p>按 “<strong>i</strong>” 或 “<strong>insert</strong>” 切换至编辑模式，将以下内容输入 server.js。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>http</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;http&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>handleRequest</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Received request for URL: &#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>writeHead</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>end</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Hello World!&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>};</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>www</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>createServer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>handleRequest</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>www</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>listen</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>按 “<strong>Esc</strong>”，输入 “<strong>:wq</strong>”，保存文件并返回。</p></li><li><p>执行以下命令，执行 server.js 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>node server.js
</code></pre></div></li><li><p>测试 Hello World 程序，有以下两种办法。 1. 另起一个终端，再次登录节点，执行以下命令。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>   curl 127.0.0.1:80

   # 终端会输出一下信息
   Hello World!
</code></pre></div><ol><li><p>打开本地主机的浏览器，以<code>IP地址:端口</code>的形式访问，端口为80。 网页出现<code>Hello world!</code>说明 Hello World 程序运行成功。</p><blockquote><p>注意：如果本地主机不在该节点所在的内网，IP地址应该是该节点的外网地址</p></blockquote></li></ol></li></ol><h4 id=创建-docker-镜像>创建 Docker 镜像</h4><ol><li><p>在 hellonode 文件夹下，创建 Dockerfile 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[root@VM_1_98_centos hellonode]# vim Dockerfile
</code></pre></div></li><li><p>按 “<strong>i</strong>” 或 “<strong>insert</strong>” 切换至编辑模式，将以下内容输入 Dockerfile 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>FROM node:4.4
EXPOSE 80
COPY server.js .
CMD node server.js
</code></pre></div><p>按 “<strong>Esc</strong>”，输入 “<strong>:wq</strong>”，保存文件并返回。</p></li><li><p>执行以下命令，构建镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>docker build -t hello-node:v1 .
</code></pre></div></li><li><p>执行以下命令，查看构建好的 hello-node 镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>docker images
</code></pre></div><p>显示结果如下，则说明 hello-node 镜像已成功构建，记录其 IMAGE ID。如下图所示：</p><p><img src=../../../../images/helloworld-3.png alt></p></li></ol><h4 id=上传该镜像到镜像仓库>上传该镜像到镜像仓库</h4><blockquote><ul><li>已在<a href=../../../user-guide/platform-console/registry-mgmt/>【组织资源】</a>中的【镜像仓库管理】创建命名空间。</li><li>已在<a href=../../../user-guide/platform-console/registry-mgmt/>【组织资源】</a>中的【访问凭证】创建访问凭证。</li></ul></blockquote><p>依次执行以下命令，上传镜像到 qcloud 仓库。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sudo docker login -u tkestack -p 【访问凭证】 default.registry.tke.com
sudo docker tag 【IMAGEID】 default.registry.tke.com/【命名空间】/helloworld:v1
sudo docker push default.registry.tke.com/【命名空间】/helloworld:v1
</code></pre></div><blockquote><ul><li>请将命令中的 【访问凭证】 替换为 已创建的访问凭证。</li><li>请将命令中的 【IMAGEID】 替换为 你自己创建镜像的ID，示例中的ID如上图158204134510。</li><li>请将命令中的 【命名空间】 替换为 已创建的命名空间。</li></ul><p>显示以下结果，则说明镜像上传成功。 <img src=../../../../images/helloworld-4.png alt></p></blockquote><h4 id=在镜像仓库命名空间中进行确认>在镜像仓库命名空间中进行确认</h4><p><img src=../../../../images/helloworld-6.png alt></p><h3 id=通过该镜像创建-hello-world-服务>通过该镜像创建 Hello World 服务</h3><ol><li><p>登录 TKEStack 控制台。</p></li><li><p>单击左侧导航栏中【集群管理】，进入“集群管理”页面。</p></li><li><p>单击需要创建服务的集群 ID，进入工作负载 “Deployment” 详情页，选择【新建】。如下图所示：</p><p><img src=../../../../images/helloworld-5.png alt></p></li><li><p>在“新建Workload”页面，仅输入以下红框内容即可：</p><p><img src=../../../../images/helloworld-8.png alt></p><p><img src=../../../../images/helloworld-7.png alt><img src=../../../../images/helloworld-10.png alt></p><blockquote><p>注意：</p><ol><li>镜像，地址要填全：default.registry.tke.com/【命名空间】/【镜像名】，例如：default.registry.tke.com/test/helloworld</li><li>服务所在集群的安全组需要放通节点网络及容器网络，同时需要放通30000 - 32768端口，否则可能会出现容器服务无法使用问题。</li></ol></blockquote></li><li><p>单击【创建Workload】，完成 Hello World 服务的创建。</p></li></ol><h3 id=访问-hello-world-服务>访问 Hello World 服务</h3><p>可通过以下两种方式访问 Hello World 服务。</p><h4 id=通过主机节点端口访问-hello-world-服务>通过主机节点端口访问 Hello World 服务</h4><ol><li><p>选择【服务】>【Service】，在“Service”管理页面，看到与名为helloworld的Deployment同名的 helloworld Service已经运行，如下图所示：<img src=../../../../images/helloworld-11.png alt></p></li><li><p>在本地主机的浏览器地址栏输入<code>集群任意节点IP:30000 端口</code>，例如<code>10.0.0.1:30000</code>即可访问服务。如果服务创建成功，访问服务时页面会返回<code>Hello World！</code></p><blockquote><p>注意：如果本地主机在集群内网中，输入节点的内网IP地址即可；如果本地主机不在集群内网中，需要输入节点的外网IP地址</p></blockquote></li></ol><h4 id=通过服务名称访问-hello-world-服务>通过服务名称访问 Hello World 服务</h4><p>集群内的其他服务或容器可以直接通过服务名称访问。</p><p>更多关于Docker 镜像请参见 <a href=../docker-image-example>如何构建 Docker 镜像</a> 。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d2fc2e9c475dda096ccff56f6718d569>3 - 如何构建Docker镜像</h1><div class=lead>如何构建Docker镜像</div><h2 id=说明>说明</h2><p>DockerHub 提供了大量的镜像可用，详情可查看 <a href=https://hub.docker.com/>DockerHub 官网</a>。</p><p>Docker 容器的设计宗旨是让用户在相对独立的环境中运行独立的程序。</p><p>Docker 容器程序在镜像内程序运行结束后会自动退出。如果要令构建的镜像在服务中持续运行，需要在创建服务页面指定自身持续执行的程序，如：业务主程序，main 函数入口等。</p><p>由于企业环境的多样性，并非所有应用都能在 DockerHub 找到对应的镜像来使用。 您可以通过以下教程了解到如何将应用打包成Docker镜像。</p><p>Docker 生成镜像目前有两种方式：</p><ul><li>通过 Dockerfile 自动构建镜像；</li><li>通过容器操作，并执行 Commit 打包生成镜像。</li></ul><h2 id=dockerfile-自动编译生成推荐使用>Dockerfile 自动编译生成（推荐使用）</h2><p>以 Dockerhub 官方提供的 WordPress 为例，<a href=https://github.com/docker-library/wordpress/blob/7d40c4237f01892bb6dbc67d1a82f5b15f807ca1/php5.6/apache/Dockerfile>转到 github 查看详情 >></a></p><p>其 Dockfile 源码如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>FROM php:5.6-apache

# install the PHP extensions we need
RUN apt-get update &amp;&amp; apt-get install -y libpng12-dev libjpeg-dev &amp;&amp; rm -rf /var/lib/apt/lists/* \
    &amp;&amp; docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \
    &amp;&amp; docker-php-ext-install gd mysqli opcache

# set recommended PHP.ini settings
# see https://secure.php.net/manual/en/opcache.installation.php
RUN { \
        echo &#39;opcache.memory_consumption=128&#39;; \
        echo &#39;opcache.interned_strings_buffer=8&#39;; \
        echo &#39;opcache.max_accelerated_files=4000&#39;; \
        echo &#39;opcache.revalidate_freq=2&#39;; \
        echo &#39;opcache.fast_shutdown=1&#39;; \
        echo &#39;opcache.enable_cli=1&#39;; \
    } &gt; /usr/local/etc/php/conf.d/opcache-recommended.ini

RUN a2enmod rewrite expires

VOLUME /var/www/html

ENV WORDPRESS_VERSION 4.6.1
ENV WORDPRESS_SHA1 027e065d30a64720624a7404a1820e6c6fff1202

RUN set -x \
    &amp;&amp; curl -o wordpress.tar.gz -fSL &#34;https://wordpress.org/wordpress-${WORDPRESS_VERSION}.tar.gz&#34; \
    &amp;&amp; echo &#34;$WORDPRESS_SHA1 *wordpress.tar.gz&#34; | sha1sum -c - \
# upstream tarballs include ./wordpress/ so this gives us /usr/src/wordpress
    &amp;&amp; tar -xzf wordpress.tar.gz -C /usr/src/ \
    &amp;&amp; rm wordpress.tar.gz \
    &amp;&amp; chown -R www-data:www-data /usr/src/wordpress

COPY docker-entrypoint.sh /usr/local/bin/
RUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh # backwards compat

# ENTRYPOINT resets CMD
ENTRYPOINT [&#34;docker-entrypoint.sh&#34;]
CMD [&#34;apache2-foreground&#34;]
</code></pre></div><p>通过上述 Dockerfile 文件可以了解到，内置执行了许多的 Linux 命令来安装和部署软件。</p><h2 id=操作步骤>操作步骤</h2><p>在终端创建一个名为worldpress的文件夹，在该文件夹下创建 Dockerfile 文件，文件内容即以上代码。通过 <code>docker build ./</code>命令来构建镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[root@VM_1_98_centos ~]# mkdir worldpress
[root@VM_1_98_centos ~]# ls
worldpress
[root@VM_1_98_centos ~]# cd worldpress/
[root@VM_1_98_centos worldpress]# vi Dockerfile
[root@VM_1_98_centos worldpress]# ls
Dockerfile
[root@VM_1_98_centos worldpress]# docker build ./
Sending build context to Docker daemon  3.072kB
Step 1/12 : FROM php:5.6-apache
5.6-apache: Pulling from library/php
5e6ec7f28fb7: Pull complete
cf165947b5b7: Pull complete
7bd37682846d: Pull complete
······
</code></pre></div><p>通过 docker images 命令即可查看到构建完成的镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[root@VM_88_88_centos worldpress]# docker images
REPOSITORY                                     TAG                 IMAGE ID            CREATED             SIZE
worldpress                                     latest              9f0b470b5ddb        12 minutes ago      420 MB
docker.io/php                                  5.6-apache          eb8333e24502        5 days ago          389.7 MB
</code></pre></div><p>使用 Dockerfile 来构建镜像有以下建议： 1. 尽量精简，不安装多余的软件包。 2. 尽量选择 Docker 官方提供镜像作为基础版本，减少镜像体积。 3. Dockerfile 开头几行的指令应当固定下来，不建议频繁更改，有效利用缓存。 4. 多条 RUN 命令使用''连接，有利于理解且方便维护。 5. 通过 -t 标记构建镜像，有利于管理新创建的镜像。 6. 不在 Dockerfile 中映射公有端口。 7. Push 前先在本地运行，确保构建的镜像无误。</p><h2 id=执行-commit-实现打包生成镜像>执行 Commit 实现打包生成镜像</h2><p>通过 Dockerfile 可以快速构建镜像，而通过 commit 生成镜像可以解决应用在部署过程中有大量交互内容以及难以通过 Dockerfile 构建的问题。</p><p>通过 commit 构建镜像操作如下： 1. 运行基础镜像容器，并进入console。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[root@VM_88_88_centos ~]# docker run -i -t centos
[root@f5f1beda4075 /]#
</code></pre></div><ol><li><p>安装需要的软件，并添加配置。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[root@f5f1beda4075 /]# yum update &amp;&amp; yum install  openssh-server
Loaded plugins: fastestmirror, ovl
base                                                                                                                                                                    | 3.6 kB  00:00:00     
extras                                                                                                                                                                  | 3.4 kB  00:00:00     
updates                                                                                                                                                                 | 3.4 kB  00:00:00     
(1/4): base/7/x86_64/group_gz                                                                                                                                           | 155 kB  00:00:00     
(2/4): extras/7/x86_64/primary_db                                                                                                                                       | 166 kB  00:00:00     
(3/4): base/7/x86_64/primary_db                                                                                                                                         | 5.3 MB  00:00:00     
(4/4): updates/7/x86_64/primary_db 
......
......
......
Dependency Installed:
fipscheck.x86_64 0:1.4.1-5.el7              fipscheck-lib.x86_64 0:1.4.1-5.el7              openssh.x86_64 0:6.6.1p1-25.el7_2              tcp_wrappers-libs.x86_64 0:7.6-77.el7             
Complete!
</code></pre></div></li><li><p>配置完成后打开新终端保存该镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>shell
[root@VM_88_88_centos ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
f5f1beda4075        centos              &#34;/bin/bash&#34;         8 minutes ago       Up 8 minutes                            hungry_kare
[root@VM_88_88_centos ~]# docker commit f5f1beda4075 test:v1.0      
sha256:65325ffd2af9d574afca917a8ce81cf8a710e6d1067ee611a87087e1aa88e4a4
[root@VM_88_88_centos ~]# 
[root@VM_88_88_centos ~]# docker images
REPOSITORY                                     TAG                 IMAGE ID            CREATED             SIZE
test                                           v1.0                65325ffd2af9        11 seconds ago      307.8 MB
</code></pre></div></li></ol></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>