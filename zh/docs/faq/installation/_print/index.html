<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/web/zh/docs/faq/installation/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>部署类 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="部署类"><meta property="og:description" content="部署类
"><meta property="og:type" content="website"><meta property="og:url" content="/web/zh/docs/faq/installation/"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="部署类"><meta itemprop=description content="部署类
"><meta name=twitter:card content="summary"><meta name=twitter:title content="部署类"><meta name=twitter:description content="部署类
"><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/web/zh/docs/faq/installation/>返回本页常规视图</a>.</p></div><h1 class=title>部署类</h1><div class=lead>部署类</div><ul><li>1: <a href=#pg-b8f921c63eb2036fad5fab1c2e72c5b1>常见报错解决方法</a></li><li>2: <a href=#pg-3e73535e494af894f5902f692b59baf4>如何规划部署资源</a></li><li>3: <a href=#pg-58327445a09d8b72487f4353c19c5201></a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-b8f921c63eb2036fad5fab1c2e72c5b1>1 - 常见报错解决方法</h1><div class=lead>常见报错解决方法</div><p>当前 TKEStack 使用 tke-Installer 一键安装，安装过程中的错误主要集中在硬件和软件配置上，安装前请仔细阅读环境要求文档：</p><ul><li><a href=../../../installation/environment-requirement>部署环境要求</a></li></ul><h3 id=如何重新部署集群>如何重新部署集群</h3><h4 id=重试安装>重试安装</h4><p>若安装报错后，请先排障，再登录到 Installer 节点执行如下命令后，重新打开 <code>http://[tke-installer-IP]:8080/index.html</code> 安装控制台。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>docker restart tke-installer
</code></pre></div><h4 id=重新安装>重新安装</h4><p>安装报错后，请先排障，再登录到 Installer 节点执行如下命令后，重新打开 <code>http://[tke-installer-IP]:8080/index.html</code> 安装控制台。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>rm -rf /opt/tke-installer &amp;&amp; docker restart tke-installer
</code></pre></div><p><code>注：重新安装前，请先清理节点上的残留：</code><a href=../frequently-answer#qing-chu-can-liu><code>清除残留</code></a></p><h4 id=清除残留>清除残留</h4><p>在添加新的节点或者重装环境之前，需要彻底清理节点，请对 Installer 或所有加入的节点执行下方脚本清理残留配置和文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>curl -s https://tke-release-1251707795.cos.ap-guangzhou.myqcloud.com/tools/clean.sh | sh
</code></pre></div><p>或者使用如下脚本：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>#!/bin/bash

rm -rf /etc/kubernetes

systemctl stop kubelet 2&gt;/dev/null

docker rm -f $(docker ps -aq) 2&gt;/dev/null
systemctl stop docker 2&gt;/dev/null

ip link del cni0 2&gt;/etc/null

for port in 80 2379 6443 8086 {10249..10259} ; do
    fuser -k -9 ${port}/tcp
done

rm -rfv /etc/kubernetes
rm -rfv /etc/docker
rm -fv /root/.kube/config
rm -rfv /var/lib/kubelet
rm -rfv /var/lib/cni
rm -rfv /etc/cni
rm -rfv /var/lib/etcd
rm -rfv /var/lib/postgresql /etc/core/token /var/lib/redis /storage /chart_storage

systemctl start docker 2&gt;/dev/null
</code></pre></div><blockquote><p>注：如有混合部署其他业务，请基于实际情况评估目录内数据是否可删除。</p></blockquote><h3 id=安装密码报错>安装密码报错</h3><p>错误情况：使用密码安装 Global 集群报 <code>ssh:unable to authenticate</code> 错误</p><p>解决方案：将 Global 集群节点<code>/etc/ssh/sshd_config</code>配置文件中的<code>PasswordAuthentication</code>设为<code>yes</code>，重启<code>sshd</code>服务。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3e73535e494af894f5902f692b59baf4>2 - 如何规划部署资源</h1><div class=lead>如何规划部署资源</div><p>TKEStack支持使用物理机或虚拟机部署，采用kubernetes on kubernetes架构部署，在主机上只拥有一个物理机进程kubelet，其他kubernetes组件均为容器。架构上分为global集群和业务集群。global集群，运行整个TKEStack平台自身所需要的组件，业务集群运行用户业务。在实际的部署过程中，可根据实际情况进行调整。</p><p>安装TKEStack，需要提供两种角色的 Server：</p><p>Installer server 1台，用以部署集群安装器，安装完成后可以回收。</p><p>Global server，若干台，用以部署 Globa 集群，常见的部署模式分为三种：</p><ol><li><strong>All in one 模式</strong>，1台server部署 Global集群，global集群同时也充当业务集群的角色，即运行平台基础组件，又运行业务容器。global集群会默认设置taint不可调度，使用此模式时，需要手工在golbal集群【节点管理】-【更多】-【编辑Taint】中去除不可调度设置。(关于taint，<a href=https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>了解更多</a>)。由于此种模式不具有高可用能力，不建议在生产环境中使用。</li><li><strong>Global 与业务集群混部的高可用模式</strong>，3台Server部署global集群，global集群同时也充当业务集群的角色，即运行平台基础组件，又运行业务容器。global集群会默认设置taint不可调度，使用此模式时，需要手工在golbal集群【节点管理】-【更多】-【编辑Taint】中去除不可调度设置。(关于taint，<a href=https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>了解更多</a>)。由于此种模式有可能因为业务集群资源占用过高而影响global集群，不建议在生产环境中使用。</li><li><strong>Global 与业务集群分别部署的高可用模式</strong>，3台Server部署global集群，仅运行平台自身组件，业务集群单独在TKEStack控制台上创建（建议3台以上），此种模式下，业务资源占有与平台隔离，建议在生产环境中使用此种模式。</li></ol><p>集群节点主机配置，请参考<a href=../../../installation/environment-requirement>资源需求</a>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-58327445a09d8b72487f4353c19c5201>3 -</h1><h1 id=如何使用存储>如何使用存储</h1><p>TKEStack 没有提供存储服务，Global集群中的镜像仓库、ETCD、InfluxDB等数据组件，均使用本地磁盘存储数据。如果您需要使用存储服务，建议使用<a href=https://rook.io/>ROOK</a>或者<a href=https://chubao.io/>chubaoFS</a>，部署一套容器化的分布式存储服务。</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>