<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/web/zh/docs/faq/platforms/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>平台类 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="平台类"><meta property="og:description" content="平台类
"><meta property="og:type" content="website"><meta property="og:url" content="/web/zh/docs/faq/platforms/"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="平台类"><meta itemprop=description content="平台类
"><meta name=twitter:card content="summary"><meta name=twitter:title content="平台类"><meta name=twitter:description content="平台类
"><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/web/zh/docs/faq/platforms/>返回本页常规视图</a>.</p></div><h1 class=title>平台类</h1><div class=lead>平台类</div><ul><li>1: <a href=#pg-852ca1f3c1d8d32606c39d8b9ac6bc92>监控告警指标列表</a></li><li>2: <a href=#pg-baff2ca79a98af2bf6bd50bb78eba197>平台使用常见问题</a></li><li>3: <a href=#pg-ffbedc5de4acf913b9e55cd882a364ef></a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-852ca1f3c1d8d32606c39d8b9ac6bc92>1 - 监控告警指标列表</h1><div class=lead>监控告警指标列表</div><h2 id=监控--告警指标列表>监控 & 告警指标列表</h2><p>目前 TKEStack 提供了以下维度的监控指标，所有指标均为统计周期内的<strong>平均值</strong>。</p><h3 id=监控>监控</h3><h4 id=集群监控指标>集群监控指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>CPU 利用率</td><td style=text-align:left>%</td><td style=text-align:left>集群整体的 CPU 利用率</td></tr><tr><td style=text-align:left>内存利用率</td><td style=text-align:left>%</td><td style=text-align:left>集群整体的内存利用率</td></tr></tbody></table><h4 id=节点监控指标>节点监控指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>Pod 重启次数</td><td style=text-align:left>次</td><td style=text-align:left>节点内所有 Pod 的重启次数之和</td></tr><tr><td style=text-align:left>异常状态</td><td style=text-align:left>-</td><td style=text-align:left>节点的状态，正常或异常</td></tr><tr><td style=text-align:left>CPU 利用率</td><td style=text-align:left>%</td><td style=text-align:left>节点内所有 Pod 的 CPU 使用量占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率</td><td style=text-align:left>%</td><td style=text-align:left>节点内所有 Pod 的内存使用量占节点总量之比</td></tr><tr><td style=text-align:left>内网入带宽</td><td style=text-align:left>bps</td><td style=text-align:left>节点内所有 Pod 的内网入方向带宽之和</td></tr><tr><td style=text-align:left>内网出带宽</td><td style=text-align:left>bps</td><td style=text-align:left>节点内所有 Pod 的内网出方向带宽之和</td></tr><tr><td style=text-align:left>外网入带宽</td><td style=text-align:left>bps</td><td style=text-align:left>节点内所有 Pod 的外网入方向带宽之和</td></tr><tr><td style=text-align:left>外网出带宽</td><td style=text-align:left>bps</td><td style=text-align:left>节点内所有 Pod 的外网出方向带宽之和</td></tr><tr><td style=text-align:left>TCP 连接数</td><td style=text-align:left>个</td><td style=text-align:left>节点保持的 TCP 连接数</td></tr></tbody></table><h4 id=工作负载监控指标>工作负载监控指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>Pod 重启次数</td><td style=text-align:left>次</td><td style=text-align:left>工作负载内所有 Pod 的重启次数之和</td></tr><tr><td style=text-align:left>CPU 使用量</td><td style=text-align:left>核</td><td style=text-align:left>工作负载内所有 Pod 的 CPU 使用量</td></tr><tr><td style=text-align:left>CPU 利用率（占集群）</td><td style=text-align:left>%</td><td style=text-align:left>工作负载内所有 Pod 的 CPU 使用量占集群总量之比</td></tr><tr><td style=text-align:left>内存使用量</td><td style=text-align:left>B</td><td style=text-align:left>工作负载内所有 Pod 的内存使用量</td></tr><tr><td style=text-align:left>内存利用率（占集群）</td><td style=text-align:left>%</td><td style=text-align:left>工作负载内所有 Pod 的内存使用量占集群总量之比</td></tr><tr><td style=text-align:left>网络入带宽</td><td style=text-align:left>bps</td><td style=text-align:left>工作负载内所有 Pod 的入方向带宽之和</td></tr><tr><td style=text-align:left>网络出带宽</td><td style=text-align:left>bps</td><td style=text-align:left>工作负载内所有 Pod 的出方向带宽之和</td></tr><tr><td style=text-align:left>网络入流量</td><td style=text-align:left>B</td><td style=text-align:left>工作负载内所有 Pod 的入方向流量之和</td></tr><tr><td style=text-align:left>网络出流量</td><td style=text-align:left>B</td><td style=text-align:left>工作负载内所有 Pod 的出方向流量之和</td></tr><tr><td style=text-align:left>网络入包量</td><td style=text-align:left>个/s</td><td style=text-align:left>工作负载内所有 Pod 的入方向包数之和</td></tr><tr><td style=text-align:left>网络出包量</td><td style=text-align:left>个/s</td><td style=text-align:left>工作负载内所有 Pod 的出方向包数之和</td></tr></tbody></table><h4 id=pod-监控指标>Pod 监控指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>异常状态</td><td style=text-align:left>-</td><td style=text-align:left>Pod 的状态，正常或异常</td></tr><tr><td style=text-align:left>CPU 使用量</td><td style=text-align:left>核</td><td style=text-align:left>Pod 的 CPU 使用量</td></tr><tr><td style=text-align:left>CPU 利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的 CPU 使用量占节点总量之比</td></tr><tr><td style=text-align:left>CPU 利用率（占 Request）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的 CPU 使用量和设置的 Request 值之比</td></tr><tr><td style=text-align:left>CPU 利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的 CPU 使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>内存使用量</td><td style=text-align:left>B</td><td style=text-align:left>Pod 的内存使用量，含缓存</td></tr><tr><td style=text-align:left>内存使用量（不包含 Cache）</td><td style=text-align:left>B</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）</td></tr><tr><td style=text-align:left>内存利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的内存使用量占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率（占节点，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率（占 Request）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的内存使用量和设置的 Request 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Request，不包含Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）和设置的 Request 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的内存使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Limit，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>网络入带宽</td><td style=text-align:left>bps</td><td style=text-align:left>Pod 的入方向带宽之和</td></tr><tr><td style=text-align:left>网络出带宽</td><td style=text-align:left>bps</td><td style=text-align:left>Pod 的出方向带宽之和</td></tr><tr><td style=text-align:left>网络入流量</td><td style=text-align:left>B</td><td style=text-align:left>Pod 的入方向流量之和</td></tr><tr><td style=text-align:left>网络出流量</td><td style=text-align:left>B</td><td style=text-align:left>Pod 的出方向流量之和</td></tr><tr><td style=text-align:left>网络入包量</td><td style=text-align:left>个/s</td><td style=text-align:left>Pod 的入方向包数之和</td></tr><tr><td style=text-align:left>网络出包量</td><td style=text-align:left>个/s</td><td style=text-align:left>Pod 的出方向包数之和</td></tr></tbody></table><h4 id=container-监控指标>Container 监控指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>CPU 使用量</td><td style=text-align:left>核</td><td style=text-align:left>Container 的 CPU 使用量</td></tr><tr><td style=text-align:left>CPU 利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的 CPU 使用量占节点总量之比</td></tr><tr><td style=text-align:left>CPU 利用率（占 Request）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的 CPU 使用量和设置的 Request 值之比</td></tr><tr><td style=text-align:left>CPU 利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的 CPU 使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>内存使用量</td><td style=text-align:left>B</td><td style=text-align:left>Container 的内存使用量，含缓存</td></tr><tr><td style=text-align:left>内存使用量（不包含 Cache）</td><td style=text-align:left>B</td><td style=text-align:left>Container 的真实内存使用量（不含缓存）</td></tr><tr><td style=text-align:left>内存利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的内存使用量占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率（占节点，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的真实内存使用量（不含缓存）占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率（占 Request）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的内存使用量和设置的 Request 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Request，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的真实内存使用量（不含缓存）和设置的 Request 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的内存使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Limit，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Container 的真实内存使用量（不含缓存）和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>块设备读带宽</td><td style=text-align:left>B/s</td><td style=text-align:left>Container 从硬盘读取数据的吞吐量</td></tr><tr><td style=text-align:left>块设备写带宽</td><td style=text-align:left>B/s</td><td style=text-align:left>Container 把数据写入硬盘的吞吐量</td></tr><tr><td style=text-align:left>块设备读 IOPS</td><td style=text-align:left>次/s</td><td style=text-align:left>Container 从硬盘读取数据的 IO 次数</td></tr><tr><td style=text-align:left>块设备写 IOPS</td><td style=text-align:left>次/s</td><td style=text-align:left>Container 把数据写入硬盘的 IO 次数</td></tr></tbody></table><h3 id=告警>告警</h3><p>目前容器服务提供了以下维度的告警指标，所有指标均为统计周期内的<strong>平均值</strong>。</p><h4 id=集群告警指标>集群告警指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>CPU 利用率</td><td style=text-align:left>%</td><td style=text-align:left>集群整体的 CPU 利用率</td></tr><tr><td style=text-align:left>内存利用率</td><td style=text-align:left>%</td><td style=text-align:left>集群整体的内存利用率</td></tr><tr><td style=text-align:left>CPU 分配率</td><td style=text-align:left>%</td><td style=text-align:left>集群所有容器设置的 CPU Request 之和与集群总可分配 CPU 之比</td></tr><tr><td style=text-align:left>内存分配率</td><td style=text-align:left>%</td><td style=text-align:left>集群所有容器设置的内存 Request 之和与集群总可分配内存之比</td></tr><tr><td style=text-align:left>Apiserver 正常</td><td style=text-align:left>-</td><td style=text-align:left>Apiserver 状态，默认 False 时告警，仅独立集群支持该指标</td></tr><tr><td style=text-align:left>ETCD 正常</td><td style=text-align:left>-</td><td style=text-align:left>ETCD 状态，默认 False 时告警，仅独立集群支持该指标</td></tr><tr><td style=text-align:left>Scheduler 正常</td><td style=text-align:left>-</td><td style=text-align:left>Scheduler 状态，默认 False 时告警，仅独立集群支持该指标</td></tr><tr><td style=text-align:left>Controll Manager 正常</td><td style=text-align:left>-</td><td style=text-align:left>Controll Manager 状态，默认 False 时告警，仅独立集群支持该指标</td></tr></tbody></table><h4 id=节点告警指标>节点告警指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>CPU 利用率</td><td style=text-align:left>%</td><td style=text-align:left>节点内所有 Pod 的 CPU 使用量占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率</td><td style=text-align:left>%</td><td style=text-align:left>节点内所有 Pod 的内存使用量占节点总量之比</td></tr><tr><td style=text-align:left>节点上 Pod 重启次数</td><td style=text-align:left>次</td><td style=text-align:left>节点内所有 Pod 重启次数之和</td></tr><tr><td style=text-align:left>Node Ready</td><td style=text-align:left>-</td><td style=text-align:left>节点状态，默认 False 时告警</td></tr></tbody></table><h4 id=pod-告警指标>Pod 告警指标</h4><table><thead><tr><th style=text-align:left>指标</th><th style=text-align:left>单位</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>CPU 利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的 CPU 使用量占节点总量之比</td></tr><tr><td style=text-align:left>内存利用率（占节点）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的内存使用量占节点总量之比</td></tr><tr><td style=text-align:left>实际内存利用率（占节点，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）占节点总量之比</td></tr><tr><td style=text-align:left>CPU 利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的CPU使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>内存利用率（占 Limit）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 的内存使用量和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>实际内存利用率（占 Limit，不包含 Cache）</td><td style=text-align:left>%</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量（不含缓存）和设置的 Limit 值之比</td></tr><tr><td style=text-align:left>Pod 重启次数</td><td style=text-align:left>次</td><td style=text-align:left>Pod 的重启次数</td></tr><tr><td style=text-align:left>Pod Ready</td><td style=text-align:left>-</td><td style=text-align:left>Pod 的状态，默认 False 时告警</td></tr><tr><td style=text-align:left>CPU 使用量</td><td style=text-align:left>核</td><td style=text-align:left>Pod 的 CPU 使用量</td></tr><tr><td style=text-align:left>内存使用量</td><td style=text-align:left>MB</td><td style=text-align:left>Pod 的内存使用量，含缓存</td></tr><tr><td style=text-align:left>实际内存使用量</td><td style=text-align:left>MB</td><td style=text-align:left>Pod 内所有 Container 的真实内存使用量之和，不含缓存</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-baff2ca79a98af2bf6bd50bb78eba197>2 - 平台使用常见问题</h1><div class=lead>平台使用常见问题</div><p><strong>此处为平台使用常见问题，在使用 TKEStack 过程中，欢迎在</strong> <a href=https://github.com/tkestack/tke/issues/new/choose><strong>issue</strong></a> <strong>上提出自己的问题，最好配上相关的信息和截图，以便我们更好定位问题所在，每个</strong> <a href=https://github.com/tkestack/tke/issues><strong>issue</strong></a> <strong>我们都会认真对待。</strong></p><h2 id=apiserver-的-real-和-advertise>APIServer 的 Real 和 Advertise</h2><p><img src=../../../../images/image%20%28108%29.png alt></p><p><strong>Real</strong>：表示 Master 节点 APIServer</p><p><strong>Advertise</strong>：表示高可用 VIP 的 APIServer、或者是各大云厂商托管集群的 APIServer 地址</p><h2 id=global-集群没出现>global 集群没出现</h2><p>参考：清除浏览器缓存</p><h2 id=field-is-immuable>field is immuable</h2><p><img src=../../../../images/image%20%2880%29.png alt></p><p>参考：表示已有同名对象，例如已有同名 Service，需要手动删除 Service，或者换个名字</p><h2 id=控制台无法编辑节点-taint>控制台无法编辑节点 Taint</h2><p>在部署负载时，有时会出现下图中的事件，表示节点被 Taint</p><p><img src=../../../../images/image%20%2852%29.png alt></p><p>原因：通过 TKEStack 部署的集群里 Master 节点默认带污点（taint），是为了防止业务 Pod 运行在 Master 节点上，此时如果平台有问题的话，业务也会挂掉。但在测试环境中，节点有限的情况下，可以适当删除节点的 taint，但在控制台上没办法删掉，只能在命令行删除</p><p><img src=../../../../images/image%20%28126%29.png alt></p><h2 id=nodes-had-tiant>node(s) had tiant</h2><p>解决方法和上图一样，删除或注释节点中的 taint</p><h2 id=镜像仓库镜像上传问题>镜像仓库镜像上传问题</h2><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>WARNING! Using --password via the CLI is insecure. Use --password-stdin.
Error response from daemon: Get https://defult.registry.tke.com/v2/: dial tcp: lookup defult.registry.tke.com on 183.60.83.19:53: no such host
</code></pre></div><p>很可能是因为 Registry container 没有启动</p><p>kubectl get pod -n tke | grep tke-registry</p><h2 id=事件持久化插件无法点击完成来添加>事件持久化插件无法点击完成来添加</h2><p>原因：在页面下方要添加用于持久化的 ES 地址和索引</p><blockquote><p>注意：当前只支持未开启 用户登录认证 的 ES 集群</p></blockquote><h2 id=业务管理界面没有找到想要的业务>业务管理界面没有找到想要的业务</h2><p>因为当前用户不是该业务的成员，需要为该业务添加成员用户</p><p><img src=../../../../images/image%20%2812%29.png alt></p><h2 id=业务的-ns-只能选择一个集群>业务的 NS 只能选择一个集群</h2><p>业务下的每个命名空间只能选取一个集群，因为是在这个集群下面新建的这个命名空间</p><p><img src=../../../../images/image%20%2898%29.png alt></p><h2 id=数据卷-以主机路径为例>数据卷 以主机路径为例</h2><p>主机路径为节点上的一个地址</p><blockquote><p>注意：主机路径指的是 Pod 所在主机的路径</p></blockquote><p><img src=../../../../images/image%20%28124%29.png alt></p><p>下图2和3中的 testv 相当于一个标签，用于指定不同的挂载类型，本例为主机路径</p><p>4中的目录为容器中的目录，会在容器的根目录中创建一个 <code>hahaha</code> 的文件夹</p><p>最后一个框为路径<code>/hahaha</code>下面的路径,可不填</p><p><img src=../../../../images/image%20%28113%29.png alt></p><p>使用数据卷的效果：主机上的主机路径和容器上的<code>hahaha</code>文件夹中的内容完全一致</p><h2 id=kube-state-metrics-和-metric-server-的区别>kube-state-metrics 和 metric-server 的区别</h2><h3 id=metric-server>metric-server</h3><p>TKEStack 的 Global 集群和新建的独立集群会默认安装名为 <a href=https://github.com/kubernetes-sigs/metrics-server>metric-server</a> 的负载，是一个容器资源监控和性能分析工具。只是显示数据，并不提供数据存储服务，类似 <a href=https://github.com/google/cadvisor>cAdvisor</a>（默认集成在 kubelet 中）、heapster（已被 metric-server 替代），可以利用 metric-server 提供的数据实现 <a href=https://github.com/tkestack/tke/blob/master/docs/guide/zh-CN/products/business-control-pannel/application/autoscale/HPA.md>HPA</a></p><h3 id=kube-state-metrics>kube-state-metrics</h3><p>使用 TKEStack 为集群安装 <a href=https://github.com/tkestack/tke/blob/master/hack/addon/readme/Prometheus.md>Prometheus</a> 监控组件时会安装名为 <a href=https://github.com/kubernetes/kube-state-metrics>kube-state-metrics</a> 的负载，用于为 Prometheus 提供监控数据。kube-state-metrics 基于 client-go 开发的服务，监听 Kubernetes APIServer，并将 Kubernetes 的结构化信息转换为 metrics，它不关注单个 Kubernetes 组件的运行状况，而是关注内部各种对象（例如 Deployment、Node、Pod）的运行状况。</p><p>kube-state-metrics 和 metric-server 一样，只是简单提供一个 metrics 数据，并不会存储这些指标数据，所以我们可以使用 Prometheus 来抓取这些数据然后存储</p><p>kube-state-metrics-service.yaml 中有 prometheus.io/scrape: &lsquo;true&rsquo; 标识，因此会将 metrics 暴露给Prometheus，而 Prometheus 会在 kubernetes-service-endpoints 这个 job 下自动发现 kube-state-metrics，并开始拉取 metrics，无需其他配置。</p><p>使用 kube-state-metrics 后的常用场景有：</p><ul><li>存在执行失败的 Job: kube_job_status_failed{job=&ldquo;kubernetes-service-endpoints&rdquo;,k8s_app=&ldquo;kube-state-metrics&rdquo;}==1</li><li>集群节点状态错误: kube_node_status_condition{condition=&ldquo;Ready&rdquo;,status!=&ldquo;true&rdquo;}==1</li><li>集群中存在启动失败的 Pod：kube_pod_status_phase{phase=~&ldquo;Failed|Unknown&rdquo;}==1</li><li>最近30分钟内有 Pod 容器重启: changes(kube_pod_container_status_restarts[30m])>0</li><li>配合报警可以更好地监控集群的运行</li></ul><h3 id=区别>区别</h3><ul><li>kube-state-metrics 主要关注的是业务相关的一些元数据，针对是是 k8s 集群内资源对象数据，比如 Deployment、Pod、副本状态等</li><li>metrics-server 主要关注的是<a href=https://github.com/kubernetes/community/blob/master/contributors/design-proposals/instrumentation/resource-metrics-api.md>资源度量 API</a> 的实现，比如 CPU、文件描述符、内存、请求延时等指标</li><li>metric-server（或 heapster）是从 api-server 中获取 CPU、内存使用率这种监控指标，并把他们发送给存储后端，如 InfluxDB 或云厂商，他当前的核心作用是：为 HPA 等组件提供决策指标支持</li><li>kube-state-metrics关注于获取 k8s 各种资源的最新状态，如 Deployment 或者 DaemonSet，之所以没有把 kube-state-metrics 纳入到 metric-server 的能力中，是因为他们的关注点本质上是不一样的。 metric-server 仅仅是获取、格式化现有数据，写入特定的存储，实质上是一个监控系统。而 kube-state-metrics 是将 k8s 的运行状况在内存中做了个快照，并且获取新的指标，但他没有能力导出这些指标</li><li>换个角度讲，kube-state-metrics 本身是 metric-server 的一种数据来源，虽然现在没有这么做</li><li>另外，像 Prometheus 这种监控系统，并不会去用 metric-server 中的数据，他都是自己做指标收集、集成的（Prometheus 包含了 metric-server的能力），但 Prometheus 可以监控 metric-server本 身组件的监控状态并适时报警，这里的监控就可以通过 kube-state-metrics 来实现，如 metric-server 的 Pod 的运行状态</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ffbedc5de4acf913b9e55cd882a364ef>3 -</h1><h1 id=平台使用常见问题>平台使用常见问题</h1></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>