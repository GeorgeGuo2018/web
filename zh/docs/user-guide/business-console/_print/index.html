<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/web/zh/docs/user-guide/business-console/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>业务管理控制台 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="业务管理控制台"><meta property="og:description" content="业务管理控制台
"><meta property="og:type" content="website"><meta property="og:url" content="/web/zh/docs/user-guide/business-console/"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="业务管理控制台"><meta itemprop=description content="业务管理控制台
"><meta name=twitter:card content="summary"><meta name=twitter:title content="业务管理控制台"><meta name=twitter:description content="业务管理控制台
"><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/web/zh/docs/user-guide/business-console/>返回本页常规视图</a>.</p></div><h1 class=title>业务管理控制台</h1><div class=lead>业务管理控制台</div><ul><li>1: <a href=#pg-402ac28c5481bba81202ae278bdded53>应用管理</a></li><ul><li>1.1: <a href=#pg-4e15f7e3621280c263719d94afc30139>命名空间</a></li><li>1.2: <a href=#pg-581be5ed4a9d7b276c4f2421596a48bb>工作负载</a></li><ul><li>1.2.1: <a href=#pg-283c1811e1a2396cc1491fc9f195b181>Deployment</a></li><li>1.2.2: <a href=#pg-66e0e51b3c40c38b649dd3f8274df967>StatefulSet</a></li><li>1.2.3: <a href=#pg-1b3dcfb569c1dd11bfb7abfcf169910a>DaomonSet</a></li><li>1.2.4: <a href=#pg-ca95b6ae5265a54d37b41c7ecda011ff>Job</a></li><li>1.2.5: <a href=#pg-1a3700b417d983d15f664242eb43d9d2>CronJob</a></li><li>1.2.6: <a href=#pg-942ebebfffb5f5766dfc29a3ff54c3d9>TApp</a></li><li>1.2.7: <a href=#pg-8f31787affb2101a550d608ac7166151>工作负载的请求与限制</a></li></ul><li>1.3: <a href=#pg-728de0d6037af6e8c4dd3d3cd18a58aa>服务</a></li><ul><li>1.3.1: <a href=#pg-c01661de03c27cf20d354588e9284d09>Service</a></li><li>1.3.2: <a href=#pg-633c3237aaeb2d075e5d341846481ed4>Ingress</a></li></ul><li>1.4: <a href=#pg-789101fc549a9485b823279e9954eed5>配置管理</a></li><ul><li>1.4.1: <a href=#pg-0c72d80fcd8fcfd427fcdb7f64153f05>ConfigMap</a></li><li>1.4.2: <a href=#pg-5a27b72a9f3556b1c20ff0496d3c3d0e>Sercet</a></li></ul><li>1.5: <a href=#pg-5133b2fd66402e8287da92f8bc3afb8a>存储</a></li><ul><li>1.5.1: <a href=#pg-29f3e5641963f81595c61e48c46454d2>PV和PVC</a></li><li>1.5.2: <a href=#pg-1ac5657bc83221fe31967a09022efbb7>StorageClass</a></li></ul><li>1.6: <a href=#pg-8c2e6b2266588f17239be429af65c27b>事件</a></li><li>1.7: <a href=#pg-14f8919cb8baa3bde4981e98721ae227>日志</a></li></ul><li>2: <a href=#pg-3057610a99f7aa499109de1965002074>业务管理</a></li><li>3: <a href=#pg-0833d65e8a0923cb315f467023b013b7>组织资源</a></li><ul><li>3.1: <a href=#pg-f5322afb855665547246929ce62f630e>镜像仓库管理</a></li><li>3.2: <a href=#pg-f0a95e137c43ada900e73e5db88f8ac3>Helm模板</a></li><li>3.3: <a href=#pg-c94ea67b479a34ed1633b3f44f2a27d9>访问凭证</a></li></ul><li>4: <a href=#pg-546cb0ff5126c40169ac9e848ea02681>监控与告警</a></li><ul><li>4.1: <a href=#pg-79be2d16b5d7949b81dad31c17ccfb47>设置告警</a></li><li>4.2: <a href=#pg-845ad2011e5c3014b6adbbdc05f6c385>通知设置</a></li></ul><li>5: <a href=#pg-22fc8e15cadbee096a9ba8d919957ba0>运维中心</a></li><ul><li>5.1: <a href=#pg-55a60e4dfe4f04261ba0510de35132f8>Helm应用</a></li><li>5.2: <a href=#pg-aecfc90660f6fc8ff8c08c88ca759f90>日志采集</a></li></ul><li>6: <a href=#pg-08c4350de537017097f922dfdd8dceaf></a></li></ul><div class=content><h1 id=业务管理控制台>业务管理控制台</h1></div></div><div class=td-content><h1 id=pg-402ac28c5481bba81202ae278bdded53>1 - 应用管理</h1><div class=lead>应用管理</div><h1 id=应用管理>应用管理</h1></div><div class=td-content><h1 id=pg-4e15f7e3621280c263719d94afc30139>1.1 - 命名空间</h1><div class=lead>命名空间</div><p>Namespaces 是 Kubernetes 在同一个集群中进行逻辑环境划分的对象， 您可以通过 Namespaces 进行管理多个团队多个项目的划分。在 Namespaces 下，Kubernetes 对象的名称必须唯一。您可以通过资源配额进行可用资源的分配，还可以进行不同 Namespaces 网络的访问控制。</p><h2 id=使用方法>使用方法</h2><ul><li>通过 TKEStack 控制台使用：TKEStack 控制台提供 Namespaces 的增删改查功能。<ul><li>【业务管理】平台下不支持对命名空间的直接操作，需在【平台管理】下<a href=../../../platform-console/business-mgmt>【业务管理】</a>中指定业务通过“创建业务下的命名空间”来实现。</li></ul></li><li>通过 Kubectl 使用：更多详情可查看 <a href=https://kubernetes.io/docs/tasks/administer-cluster/namespaces/>Kubernetes 官网文档</a>。</li></ul><h2 id=相关知识>相关知识</h2><h3 id=通过-resourcequota-设置-namespaces-资源的使用配额>通过 ResourceQuota 设置 Namespaces 资源的使用配额</h3><p>一个命名空间下可以拥有多个 ResourceQuota 资源，每个 ResourceQuota 可以设置每个 Namespace 资源的使用约束。可以设置 Namespaces 资源的使用约束如下：</p><ul><li>计算资源的配额，例如 CPU、内存。</li><li>存储资源的配额，例如请求存储的总存储。</li><li>Kubernetes 对象的计数，例如 Deployment 个数配额。</li></ul><p>不同的 Kubernetes 版本，ResourceQuota 支持的配额设置略有差异，更多详情可查看 <a href=https://kubernetes.io/docs/concepts/policy/resource-quotas/>Kubernetes ResourceQuota 官方文档</a>。 ResourceQuota 的示例如下所示：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ResourceQuota</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>object-counts</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configmaps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>## 最多10个 ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>replicationcontrollers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;20&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 最多20个 replicationcontroller</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 最多10个 secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 最多10个 service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>services.loadbalancers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>## 最多2个 Loadbanlacer 模式的 service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1000&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 该 Namespaces 下最多使用1000个 CPU 的资源</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>200Gi</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 该 Namespaces 下最多使用200Gi的内存</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-581be5ed4a9d7b276c4f2421596a48bb>1.2 - 工作负载</h1><div class=lead>工作负载</div><h1 id=工作负载>工作负载</h1></div><div class=td-content><h1 id=pg-283c1811e1a2396cc1491fc9f195b181>1.2.1 - Deployment</h1><div class=lead>Deployment</div><p>Deployment 声明了 Pod 的模板和控制 Pod 的运行策略，适用于部署无状态的应用程序。您可以根据业务需求，对 Deployment 中运行的 Pod 的副本数、调度策略、更新策略等进行声明。</p><h2 id=deployment-控制台操作指引>Deployment 控制台操作指引</h2><h3 id=创建-deployment>创建 Deployment</h3><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建Deployment的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【Deployment】管理页面。如下图所示：</li></ul><p><img src=../../../../../../images/image%20%2843%29.png alt></p><ul><li>单击【新建】，进入 “新建Workload” 页面。根据实际需求，设置 Deployment 参数。关键参数信息如下，其中必填项为<strong>工作负载名</strong>、<strong>实例内容器的名称和镜像</strong>：<ul><li><strong>工作负载名</strong>：输入自定义名称。</li><li><strong>标签</strong>：给工作负载添加标签</li><li><strong>命名空间</strong>：根据实际需求进行选择。</li><li><strong>类型</strong>：选择【Deployment（可扩展的部署 Pod）】。</li><li><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</li><li><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</li><li><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</li><li><strong>NFS盘</strong>：挂载外部NFS到Pod，用户需要指定相应NFS地址，格式：127.0.0.1:/data</li><li><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></li><li><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></li><li><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></li><li><strong>实例内容器</strong>：根据实际需求，为 Deployment 的一个 Pod 设置一个或多个不同的容器。</li></ul></li></ul><p><img src=../../../../../../images/image%20%28136%29.png alt></p><ul><li><strong>名称</strong>：自定义</li><li><strong>镜像</strong>：根据实际需求进行选择<ul><li><p><strong>镜像版本（Tag）</strong>：根据实际需求进行填写，不填默认为<code>latest</code></p></li><li><p><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性（<strong>建议使用默认值</strong>）</p></li><li><p><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</p></li><li><p><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头</p></li><li><p><strong>新增变量</strong>：自己设定变量键值对</p></li><li><p><strong>引用ConfigMap/Secret</strong>：引用已有键值对</p></li><li><p><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。</p></li><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li><li><strong>实例数量</strong>：根据实际需求选择调节方式，设置实例数量。</li></ul><p><img src=../../../../../../images/image%20%2846%29.png alt></p><ul><li><strong>手动调节</strong>：直接设定实例个数</li><li><strong>自动调节</strong>：根据设定的触发条件自动调节实例个数，目前支持根据CPU、内存利用率和利用量出入带宽等调节实例个数</li><li><strong>定时调节</strong>：根据Crontab 语法周期性设置实例个数</li><li><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</li><li><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</li><li><strong>注释（Annotations）</strong>：给Deployment添加相应Annotation，如用户信息等</li><li><strong>网络模式</strong>：选择Pod网络模式<ul><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li></ul></li><li><strong>Service</strong>：勾选【启用】按钮，配置负载端口访问</li></ul><p><img src=../../../../../../images/image%20%2866%29.png alt></p><ul><li><p><strong>服务访问方式</strong>：选择是【仅在集群内部访问】该负载还是集群外部通过【主机端口访问】该负载</p><ul><li><strong>仅在集群内访问</strong>：使用 Service 的 ClusterIP 模式，自动分配 Service 网段中的 IP，用于集群内访问。数据库类等服务如 MySQL 可以选择集群内访问，以保证服务网络隔离</li><li><strong>主机端口访问</strong>：提供一个主机端口映射到容器的访问方式，支持 TCP、UDP、Ingress。可用于业务定制上层 LB 转发到 Node</li><li><strong>Headless Service</strong>：不创建用于集群内访问的ClusterIP，访问Service名称时返回后端Pods IP地址，用于适配自有的服务发现机制。解析域名时返回相应 Pod IP 而不是 Cluster IP</li></ul></li><li><p><strong>端口映射</strong>：输入负载要暴露的端口并指定通信协议类型（<strong>容器和服务端口建议都使用80</strong>）</p></li><li><p><strong>Session Affinity:</strong> 点击【显示高级设置】出现，会话保持，设置会话保持后，会根据请求IP把请求转发给这个IP之前访问过的Pod。默认None，按需使用</p></li><li><p>单击【创建Workload】，完成创建。如下图所示：</p><p>当“运行/期望Pod数量”相等时，即表示 Deployment 下的所有 Pod 已创建完成。</p></li></ul><p><img src=../../../../../../images/workLoad.png alt></p><h3 id=更新-deployment>更新 Deployment</h3><h4 id=更新-yaml>更新 YAML</h4><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要更新的【业务】下相应的【命名空间】，展开【工作负载】列表，进入【Deployment】管理页面。如下图所示：</li></ul><p><img src=../../../../../../images/deployment.png alt></p><ul><li>在需要更新 YAML 的 Deployment 行中，单击【更多】>【编辑YAML】，进入“更新 Deployment” 页面。如下图所示：</li></ul><p><img src=../../../../../../images/updateYaml.png alt></p><ul><li>在 “更新Deployment” 页面，编辑 YAML，单击【完成】，即可更新 YAML。如下图所示：</li></ul><p><img src=../../../../../../images/editYaml.png alt=&#x66F4;&#x65B0;YAML></p><h3 id=回滚-deployment>回滚 Deployment</h3><ul><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择要变更的业务下相应的【命名空间】，展开【工作负载】列表，进入【 Deployment】 管理页面，点击进入要回滚的 Deployment 详情页面，单击【修订历史】。如下图所示：</li></ul><p><img src=../../../../../../images/podManagement.png alt></p><ul><li>选择合适版本进行回顾。</li><li>在弹出的 “回滚资源” 提示框中，单击【确定】即可完成回滚。</li></ul><h3 id=调整-pod-数量>调整 Pod 数量</h3><ul><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择要变更的业务下相应的命名空间，展开工作负载列表，进入 Deployment 管理页面。</li><li>点击 Deployment 列表操作栏的【更新实例数量】按钮。如下图所示：</li></ul><p><img src=../../../../../../images/updateNum.png alt></p><ul><li>根据实际需求调整 Pod 数量，单击【更新实例数目】即可完成调整。</li></ul><h3 id=查看deployment监控数据>查看Deployment监控数据</h3><ol><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】，。</li><li>选择要变更的业务下相应的【命名空间】，点击进入 【Deployment】 管理页面。</li><li>单击【监控】按钮，在弹出的工作负载监控页面选择工作负载查看监控信息。如下图所示：</li></ol><p><img src=../../../../../../images/workloaddata.png alt></p><h2 id=kubectl-操作-deployment-指引>Kubectl 操作 Deployment 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1beta2</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li><strong>kind</strong>：标识 Deployment 资源类型。</li><li><strong>metadata</strong>：Deployment 的名称、Namespace、Label 等基本信息。</li><li><strong>metadata.annotations</strong>：对 Deployment 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li><li><strong>spec.replicas</strong>：Deployment 管理的 Pod 数量。</li><li><strong>spec.selector</strong>：Deployment 管理 Seletor 选中的 Pod 的 Label。</li><li><strong>spec.template</strong>：Deployment 管理的 Pod 的详细模板配置。</li></ul><p>更多参数详情可查看 <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/>Kubernetes Deployment 官方文档</a>。</p><h3 id=kubectl-创建-deployment>Kubectl 创建 Deployment</h3><ol><li><p>参考 <a href=../development#YAMLSample>YAML 示例</a>，准备 Deployment YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 Deployment YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f 【Deployment YAML 文件名称】
</code></pre></div><p>例如，创建一个文件名为 nginx.Yaml 的 Deployment YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f nginx.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get deployments
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME             DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
first-workload   1         1         1            0           6h
ng               1         1         1            1           42m
</code></pre></div></li></ol><h3 id=kubectl-更新-deployment>Kubectl 更新 Deployment</h3><p>通过 Kubectl 更新 Deployment 有以下三种方法。其中，<a href=../development#%E6%96%B9%E6%B3%95%E4%B8%80>方法一</a> 和 <a href=../development#%E6%96%B9%E6%B3%95%E4%BA%8C>方法二</a> 均支持 <strong>Recreate</strong> 和 <strong>RollingUpdate</strong> 两种更新策略。</p><ul><li>Recreate 更新策略为先销毁全部 Pod，再重新创建 Deployment。</li><li>RollingUpdate 更新策略为滚动更新策略，逐个更新 Deployment 的 Pod。RollingUpdate 还支持暂停、设置更新时间间隔等。</li></ul><h4 id=方法一>方法一</h4><p>执行以下命令，更新 Deployment。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl edit  deployment/【name】
</code></pre></div><p>此方法适用于简单的调试验证，不建议在生产环境中直接使用。您可以通过此方法更新任意的 Deployment 参数。</p><h4 id=方法二>方法二</h4><p>执行以下命令，更新指定容器的镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl set image deployment/【name】 【containerName】=【image:tag】
</code></pre></div><p>建议保持 Deployment 的其他参数不变，业务更新时，仅更新容器镜像。</p><h4 id=方法三>方法三</h4><p>执行以下命令，滚动更新指定资源。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rolling-update 【NAME】 -f 【FILE】
</code></pre></div><p>更多滚动更新可参见 <a href=https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/>滚动更新说明</a>。</p><h3 id=kubectl-回滚-deployment>Kubectl 回滚 Deployment</h3><ol><li><p>执行以下命令，查看 Deployment 的更新历史。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout history deployment/【name】
</code></pre></div></li><li><p>执行以下命令，查看指定版本详情。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout history deployment/【name】 --revision=【REVISION】
</code></pre></div></li><li><p>执行以下命令，回滚到前一个版本。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout undo deployment/【name】
</code></pre></div><p>如需指定回滚版本号，可执行以下命令。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout undo deployment/【name】 --to-revision=【REVISION】
</code></pre></div></li></ol><h3 id=kubectl-调整-pod-数量>Kubectl 调整 Pod 数量</h3><h4 id=手动更新-pod-数量>手动更新 Pod 数量</h4><p>执行以下命令，手动更新 Pod 数量。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl scale deployment 【NAME】 --replicas=【NUMBER】
</code></pre></div><h4 id=自动更新-pod-数量>自动更新 Pod 数量</h4><p><strong>前提条件</strong></p><p>开启集群中的 HPA 功能。TKE 创建的集群默认开启 HPA 功能。</p><p><strong>操作步骤</strong></p><p>执行以下命令，设置 Deployment 的自动扩缩容。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl autoscale deployment 【NAME】 --min=10 --max=15 --cpu-percent=80
</code></pre></div><h3 id=kubectl-删除-deployment>Kubectl 删除 Deployment</h3><p>执行以下命令，删除 Deployment。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete deployment 【NAME】
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-66e0e51b3c40c38b649dd3f8274df967>1.2.2 - StatefulSet</h1><div class=lead>StatefulSet</div><p>StatefulSet 主要用于管理<strong>有状态</strong>的应用，创建的 Pod 拥有根据规范创建的持久型标识符。Pod 迁移或销毁重启后，<strong>标识符仍会保留</strong>。 在需要持久化存储时，您可以通过标识符对存储卷进行一一对应。如果应用程序不需要持久的标识符，建议您使用 Deployment 部署应用程序。</p><h2 id=statefulset-控制台操作指引>StatefulSet 控制台操作指引</h2><h3 id=创建-statefulset>创建 StatefulSet</h3><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建StatefulSet的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【StatefulSet】管理页面。如下图所示：</li></ul><p><img src=../../../../../../images/StatefulSet.png alt></p><ul><li><p>单击【新建】，进入 “新建Workload” 页面。根据实际需求，设置 StatefulSet 参数。</p></li><li><p>关键参数信息如下，其中必填项为<strong>工作负载名</strong>、<strong>实例内容器的名称和镜像</strong>：</p><ul><li><strong>工作负载名</strong>：输入自定义名称。</li><li><strong>标签</strong>：给工作负载添加标签</li><li><strong>命名空间</strong>：根据实际需求进行选择。</li><li><strong>类型</strong>：选择【StatefulSet】。</li><li><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</li><li><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</li><li><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</li><li><strong>NFS盘</strong>：挂载外部NFS到Pod，用户需要指定相应NFS地址，格式：127.0.0.1:/data</li><li><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></li><li><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></li><li><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></li><li><strong>实例内容器</strong>：根据实际需求，为 StatefulSet的一个 Pod 设置一个或多个不同的容器。</li><li><strong>名称</strong>：自定义</li><li><strong>镜像</strong>：根据实际需求进行选择<ul><li><strong>镜像版本（Tag）</strong>：根据实际需求进行填写，不填默认为<code>latest</code></li><li><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性（<strong>建议使用默认值</strong>）</li><li><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</li><li><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头<ul><li><strong>新增变量</strong>：自己设定变量键值对</li><li><strong>引用ConfigMap/Secret</strong>：引用已有键值对</li></ul></li><li><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。<ul><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li></ul></li><li><strong>实例数量</strong>：根据实际需求选择调节方式，设置实例数量。</li><li><strong>手动调节</strong>：直接设定实例个数</li><li><strong>自动调节</strong>：根据设定的触发条件自动调节实例个数，目前支持根据CPU、内存利用率和利用量出入带宽等调节实例个数</li><li><strong>定时调节</strong>：根据Crontab 语法周期性设置实例个数</li><li><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</li><li><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</li><li><strong>注释（Annotations）</strong>：给StatefulSet添加相应Annotation，如用户信息等</li><li><strong>网络模式</strong>：选择Pod网络模式</li><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li><li><strong>Service</strong>：勾选【启用】按钮，配置负载端口访问</li></ul><blockquote><p>注意：如果不勾选【启用】则不会创建Service</p></blockquote></li><li><p><strong>服务访问方式</strong>：选择是【仅在集群内部访问】该负载还是集群外部通过【主机端口访问】该负载</p><ul><li><strong>仅在集群内访问</strong>：使用 Service 的 ClusterIP 模式，自动分配 Service 网段中的 IP，用于集群内访问。数据库类等服务如 MySQL 可以选择集群内访问，以保证服务网络隔离</li><li><strong>主机端口访问</strong>：提供一个主机端口映射到容器的访问方式，支持 TCP、UDP、Ingress。可用于业务定制上层 LB 转发到 Node</li><li><strong>Headless Service</strong>：不创建用于集群内访问的ClusterIP，访问Service名称时返回后端Pods IP地址，用于适配自有的服务发现机制。解析域名时返回相应 Pod IP 而不是 Cluster IP</li></ul></li><li><p><strong>端口映射</strong>：输入负载要暴露的端口并指定通信协议类型（<strong>容器和服务端口建议都使用80</strong>）</p></li><li><p><strong>Session Affinity:</strong> 点击【显示高级设置】出现，会话保持，设置会话保持后，会根据请求IP把请求转发给这个IP之前访问过的Pod。默认None，按需使用</p></li><li><p>单击【创建Workload】，完成创建。</p></li></ul><h3 id=更新-statefulset>更新 StatefulSet</h3><h4 id=更新-yaml>更新 YAML</h4><ol><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要更新的【业务】下相应的【命名空间】，展开【工作负载】列表，进入【StatefulSet】管理页面。</li><li>在需要更新 YAML 的 StatefulSet 行中，选择【更多】>【编辑YAML】，进入更新 StatefulSet 页面。</li><li>在 “更新StatefulSet” 页面编辑 YAML，并单击【完成】即可更新 YAML。</li></ol><h2 id=kubectl-操作-statefulset-指引>Kubectl 操作 StatefulSet 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 创建一个 Headless Service，用于控制网络域</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>web</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterIP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>None</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StatefulSet</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>### 创建一个 Nginx的StatefulSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>web</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>serviceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;nginx&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># by default is 1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>terminationGracePeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>web</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>www</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/usr/share/nginx/html</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>volumeClaimTemplates</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>www</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>accessModes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ReadWriteOnce&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>storageClassName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;cbs&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10Gi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li><strong>kind</strong>：标识 StatefulSet 资源类型。</li><li><strong>metadata</strong>：StatefulSet 的名称、Label等基本信息。</li><li><strong>metadata.annotations</strong>：对 StatefulSet 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li><li><strong>spec.template</strong>：StatefulSet 管理的 Pod 的详细模板配置。</li><li><strong>spec.volumeClaimTemplates</strong>：提供创建 PVC&PV 的模板。</li></ul><p>更多参数详情可查看 <a href=https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/>Kubernetes StatefulSet 官方文档</a>。</p><h3 id=创建-statefulset-1>创建 StatefulSet</h3><ol><li><p>参考 <a href=../statefulset#YAMLSample>YAML 示例</a>，准备 StatefulSet YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 StatefulSet YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f StatefulSet YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 web.yaml 的 StatefulSet YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f web.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get StatefulSet
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME      DESIRED   CURRENT   AGE
test      1         1         10s
</code></pre></div></li></ol><h3 id=更新-statefulset-1>更新 StatefulSet</h3><p>执行以下命令，查看 StatefulSet 的更新策略类型。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get ds/&lt;daemonset-name&gt; -o go-template=&#39;{{.spec.updateStrategy.type}}{{&#34;\n&#34;}}&#39;
</code></pre></div><p>StatefulSet 有以下两种更新策略类型：</p><ul><li>OnDelete：默认更新策略。该更新策略在更新 StatefulSet 后，需手动删除旧的 StatefulSet Pod 才会创建新的 StatefulSet Pod。</li><li>RollingUpdate：支持 Kubernetes 1.7或更高版本。该更新策略在更新 StatefulSet 模板后，旧的 StatefulSet Pod 将被终止，并且以滚动更新方式创建新的 StatefulSet Pod（Kubernetes 1.7或更高版本）。</li></ul><h4 id=方法一>方法一</h4><p>执行以下命令，更新 StatefulSet。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl edit StatefulSet/[name]
</code></pre></div><p>此方法适用于简单的调试验证，不建议在生产环境中直接使用。您可以通过此方法更新任意的 StatefulSet 参数。</p><h4 id=方法二>方法二</h4><p>执行以下命令，更新指定容器的镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl patch statefulset &lt;NAME&gt; --type=&#39;json&#39; -p=&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;&lt;newImage&gt;&#34;}]&#39;
</code></pre></div><p>建议保持 StatefulSet 的其他参数不变，业务更新时，仅更新容器镜像。</p><p>如果更新的 StatefulSet 是滚动更新方式的策略，可执行以下命令查看更新状态：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout status sts/&lt;StatefulSet-name&gt;
</code></pre></div><h3 id=删除-statefulset>删除 StatefulSet</h3><p>执行以下命令，删除 StatefulSet。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete  StatefulSet [NAME] --cascade=false
</code></pre></div><p>&ndash;cascade=false 参数表示 Kubernetes 仅删除 StatefulSet，且不删除任何 Pod。如需删除 Pod，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete  StatefulSet [NAME]
</code></pre></div><p>更多 StatefulSet 相关操作可查看 <a href=https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#scaling-a-statefulset>Kubernetes官方指引</a>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1b3dcfb569c1dd11bfb7abfcf169910a>1.2.3 - DaomonSet</h1><div class=lead>DaomonSet</div><h2 id=daomonset>DaomonSet</h2><p>DaemonSet 主要用于部署常驻集群内的后台程序，例如节点的日志采集。DaemonSet 保证在所有或部分节点上均运行指定的 Pod。 新节点添加到集群内时，也会有自动部署 Pod；节点被移除集群后，Pod 将自动回收。</p><h2 id=调度说明>调度说明</h2><p>若配置了 Pod 的 nodeSelector 或 affinity 参数，DaemonSet 管理的 Pod 将按照指定的调度规则调度。若未配置 Pod 的 nodeSelector 或 affinity 参数，则将在所有的节点上部署 Pod。</p><h2 id=daemonset-控制台操作指引>DaemonSet 控制台操作指引</h2><h3 id=创建-daemonset>创建 DaemonSet</h3><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建DaemonSet的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【DaemonSet】管理页面。如下图所示：</li></ul><p><img src=../../../../../../images/DaemonSet.png alt></p><ul><li><p>单击【新建】，进入 “新建Workload” 页面。</p><p>根据实际需求，设置 DaemonSet 参数。关键参数信息如下：</p><ul><li><strong>工作负载名</strong>：输入自定义名称。</li><li><strong>标签</strong>：给工作负载添加标签</li><li><strong>命名空间</strong>：根据实际需求进行选择。</li><li><strong>类型</strong>：选择【DaemonSet】。</li><li><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</li><li><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</li><li><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</li><li><strong>NFS盘</strong>：挂载外部NFS到Pod，用户需要指定相应NFS地址，格式：127.0.0.1:/data</li><li><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></li><li><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></li><li><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></li><li><strong>实例内容器</strong>：根据实际需求，为 DaemonSet 的一个 Pod 设置一个或多个不同的容器。<ul><li><strong>名称</strong>：自定义。</li><li><strong>镜像</strong>：根据实际需求进行选择。</li><li><strong>镜像版本（Tag）</strong>：根据实际需求进行填写。</li><li><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性。</li><li><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</li><li><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头<ul><li><p><strong>新增变量</strong>：自己设定变量键值对</p></li><li><p><strong>引用ConfigMap/Secret</strong>：引用已有键值对</p></li><li><p><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。</p></li><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li></ul></li><li><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</li><li><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</li><li><strong>注释（Annotations）</strong>：给DaemonSet添加相应Annotation，如用户信息等</li><li><strong>网络模式</strong>：选择Pod网络模式<ul><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li></ul></li></ul></li><li><p>单击【创建Workload】，完成创建。</p></li></ul><h3 id=更新-daemonset>更新 DaemonSet</h3><h4 id=更新-yaml>更新 YAML</h4><ol><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要更新的【业务】下相应的命名空间，展开【工作负载】列表，进入【DaemonSet】管理页面。</li><li>在需要更新 YAML 的 DaemonSet 行中，选择【更多】>【编辑YAML】，进入更新 DaemonSet 页面。</li><li>在 “更新DaemonSet” 页面编辑 YAML，并单击【完成】即可更新 YAML。</li></ol><h2 id=kubectl-操作-daemonset-指引>Kubectl 操作 DaemonSet 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DaemonSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fluentd-elasticsearch</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kube-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>k8s-app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fluentd-logging</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fluentd-elasticsearch</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fluentd-elasticsearch</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>tolerations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node-role.kubernetes.io/master</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>effect</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSchedule</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fluentd-elasticsearch</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>k8s.gcr.io/fluentd-elasticsearch:1.20</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>limits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>200Mi</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>100m</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>200Mi</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>varlog</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/log</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>varlibdockercontainers</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/docker/containers</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>readOnly</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>terminationGracePeriodSeconds</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>varlog</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hostPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/log</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>varlibdockercontainers</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hostPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/docker/containers</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><blockquote><p>!以上 YAML 示例引用于 <code>https://kubernetes.io/docs/concepts/workloads/controllers/daemonset</code>， 创建时可能存在容器镜像拉取不成功的情况，仅用于本文介绍 DaemonSet 的组成。</p></blockquote><ul><li><strong>kind</strong>：标识 DaemonSet 资源类型。</li><li><strong>metadata</strong>：DaemonSet 的名称、Label等基本信息。</li><li><strong>metadata.annotations</strong>：DaemonSet 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li><li><strong>spec.template</strong>：DaemonSet 管理的 Pod 的详细模板配置。</li></ul><p>更多可查看 <a href=https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/>Kubernetes DaemonSet 官方文档</a>。</p><h3 id=kubectl-创建-daemonset>Kubectl 创建 DaemonSet</h3><ol><li><p>参考 <a href=../daomonset#YAMLSample>YAML 示例</a>，准备 DaemonSet YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 DaemonSet YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f DaemonSet YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 fluentd-elasticsearch.yaml 的 DaemonSet YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f fluentd-elasticsearch.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get DaemonSet
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME       DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR       AGE
frontend   0         0         0         0            0           app=frontend-node   16d
</code></pre></div></li></ol><h3 id=kubectl-更新-daemonset>Kubectl 更新 DaemonSet</h3><p>执行以下命令，查看 DaemonSet 的更新策略类型。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get ds/&lt;daemonset-name&gt; -o go-template=&#39;{{.spec.updateStrategy.type}}{{&#34;\n&#34;}}&#39;
</code></pre></div><p>DaemonSet 有以下两种更新策略类型：</p><ul><li>OnDelete：默认更新策略。该更新策略在更新 DaemonSet 后，需手动删除旧的 DaemonSet Pod 才会创建新的DaemonSet Pod。</li><li>RollingUpdate：支持 Kubernetes 1.6或更高版本。该更新策略在更新 DaemonSet 模板后，旧的 DaemonSet Pod 将被终止，并且以滚动更新方式创建新的 DaemonSet Pod。</li></ul><h4 id=方法一>方法一</h4><p>执行以下命令，更新 DaemonSet。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl edit DaemonSet/[name]
</code></pre></div><p>此方法适用于简单的调试验证，不建议在生产环境中直接使用。您可以通过此方法更新任意的 DaemonSet 参数。</p><h4 id=方法二>方法二</h4><p>执行以下命令，更新指定容器的镜像。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl set image ds/[daemonset-name][container-name]=[container-new-image]
</code></pre></div><p>建议保持 DaemonSet 的其他参数不变，业务更新时，仅更新容器镜像。</p><h3 id=kubectl-回滚-daemonset>Kubectl 回滚 DaemonSet</h3><ol><li><p>执行以下命令，查看 DaemonSet 的更新历史。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout history daemonset /[name]
</code></pre></div></li><li><p>执行以下命令，查看指定版本详情。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout history daemonset /[name] --revision=[REVISION]
</code></pre></div></li><li><p>执行以下命令，回滚到前一个版本。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout undo daemonset /[name]
</code></pre></div><p>如需指定回滚版本号，可执行以下命令。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl rollout undo daemonset /[name] --to-revision=[REVISION]
</code></pre></div></li></ol><h3 id=kubectl-删除-daemonset>Kubectl 删除 DaemonSet</h3><p>执行以下命令，删除 DaemonSet。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete  DaemonSet [NAME]
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ca95b6ae5265a54d37b41c7ecda011ff>1.2.4 - Job</h1><div class=lead>Job</div><h2 id=job>Job</h2><p>Job 控制器会创建 1-N 个 Pod，这些 Pod 按照运行规则运行，直至运行结束。Job 可用于批量计算、数据分析等场景。通过设置重复执行次数、并行度、重启策略等满足业务述求。 Job 执行完成后，不再创建新的 Pod，也不会删除 Pod，您可在 “日志” 中查看已完成的 Pod 的日志。如果您删除了 Job，Job 创建的 Pod 也会同时被删除，将查看不到该 Job 创建的 Pod 的日志。</p><h2 id=job-控制台操作指引>Job 控制台操作指引</h2><h3 id=创建-job>创建 Job</h3><ol><li><p>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</p></li><li><p>选择需要创建 Job 的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【 Job】 管理页面。</p></li><li><p>单击【新建】，进入 “新建Workload” 页面。如下图所示：</p><p><img src=../../../../../../images/NewJob.png alt=&#x65B0;&#x5EFA;Workload></p></li><li><p>根据实际需求，设置 Job 参数。关键参数信息如下：</p><ul><li><p><strong>工作负载名</strong>：输入自定义名称。</p></li><li><p><strong>标签</strong>：给工作负载添加标签</p></li><li><p><strong>命名空间</strong>：根据实际需求进行选择。</p></li><li><p><strong>类型</strong>：选择【Job（单次任务）】。</p></li><li><p><strong>Job设置</strong></p><ul><li><strong>重复执行次数</strong>：Job 管理的 Pod 需要重复执行的次数。</li><li><strong>并行度</strong>：Job 并行执行的 Pod 数量。</li><li><strong>失败重启策略</strong>：Pod下容器异常推出后的重启策略。<ul><li><strong>Never</strong>：不重启容器，直至 Pod 下所有容器退出。</li><li><strong>OnFailure</strong>：Pod 继续运行，容器将重新启动。</li></ul></li></ul></li><li><p><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</p></li><li><p><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</p></li><li><p><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</p></li><li><p><strong>NFS盘</strong>：挂载外部 NFS 到 Pod，用户需要指定相应 NFS 地址，格式：127.0.0.1:/data</p></li><li><p><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></p></li><li><p><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></p></li><li><p><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></p></li><li><p><strong>实例内容器</strong>：根据实际需求，为 Job 的一个 Pod 设置一个或多个不同的容器。</p><ul><li><strong>名称</strong>：自定义。</li><li><strong>镜像</strong>：根据实际需求进行选择。</li><li><strong>镜像版本（Tag）</strong>：根据实际需求进行填写。</li><li><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性。</li><li><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</li><li><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头<ul><li><p><strong>新增变量</strong>：自己设定变量键值对</p></li><li><p><strong>引用ConfigMap/Secret</strong>：引用已有键值对</p></li><li><p><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。</p></li><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li></ul></li><li><p><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</p></li><li><p><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</p></li><li><p><strong>注释（Annotations）</strong>：给Pod添加相应Annotation，如用户信息等</p></li><li><p><strong>网络模式</strong>：选择Pod网络模式</p><ul><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li></ul></li><li><p>单击【创建Workload】，完成创建。</p><p><strong>查看 Job 状态</strong></p></li></ul></li><li><p>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</p></li><li><p>选择需要创建 Job 的业务下相应的【命名空间】，展开【工作负载】下拉项，进入【 Job 】管理页面。</p></li><li><p>单击需要查看状态的【 Job 名称】，即可查看 Job 详情。</p></li></ol><h3 id=删除-job>删除 Job</h3><p>Job 执行完成后，不再创建新的 Pod，也不会删除 Pod，您可在【业务管理】控制台下的【应用管理】下的 【日志】 中查看已完成的 Pod 的日志。如果您删除了 Job，Job 创建的 Pod 也会同时被删除，将查看不到该 Job 创建的 Pod 的日志。</p><h2 id=kubectl-操作-job-指引>Kubectl 操作 Job 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Job</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>completions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parallelism</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pi</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perl</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;perl&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#4e9a06>&#34;-Mbignum=bpi&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-wle&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;print bpi(2000)&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li>kind：标识 Job 资源类型。</li><li>metadata：Job 的名称、Label等基本信息。</li><li>metadata.annotations：Job 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li><li>spec.completions：Job 管理的 Pod 重复执行次数。</li><li>spec.parallelism：Job 并行执行的 Pod 数。</li><li>spec.template：Job 管理的 Pod 的详细模板配置。</li></ul><h3 id=创建-job-1>创建 Job</h3><ol><li><p>参考 <a href=../job#YAMLSample>YAML 示例</a>，准备 Job YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>创建 Job YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f Job YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 pi.yaml 的 Job YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f pi.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get job
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME      DESIRED   SUCCESSFUL   AGE
job       1         0            1m
</code></pre></div></li></ol><h3 id=删除-job-1>删除 Job</h3><p>执行以下命令，删除 Job。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete job [NAME]
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1a3700b417d983d15f664242eb43d9d2>1.2.5 - CronJob</h1><div class=lead>CronJob</div><h2 id=cronjob>CronJob</h2><p>一个 CronJob 对象类似于 crontab（cron table）文件中的一行。它根据指定的预定计划周期性地运行一个 Job，格式可以参考 Cron。 Cron 格式说明如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># 文件格式说明
#  ——分钟（0 - 59）
# |  ——小时（0 - 23）
# | |  ——日（1 - 31）
# | | |  ——月（1 - 12）
# | | | |  ——星期（0 - 6）
# | | | | |
# * * * * *
</code></pre></div><h2 id=cronjob-控制台操作指引>CronJob 控制台操作指引</h2><h3 id=创建-cronjob>创建 CronJob</h3><ol><li><p>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</p></li><li><p>选择需要创建CronJob的业务下相应的【命名空间】，展开【工作负载】下拉项，进入【CronJob】管理页面。如下图所示：</p><p><img src=../../../../../../images/CronJobNew.png alt></p></li><li><p>单击【创建】按钮，进入 新建Workload页面。</p></li><li><p>根据实际需求，设置 CronJob 参数。关键参数信息如下：</p><ul><li><strong>工作负载名</strong>：输入自定义名称。</li><li><strong>标签</strong>：给工作负载添加标签</li><li><strong>命名空间</strong>：根据实际需求进行选择。</li><li><strong>类型</strong>：选择【CronJob（按照Cron的计划定时运行）】。</li><li><strong>执行策略</strong>：根据 Cron 格式设置任务的定期执行策略。</li><li><strong>Job设置</strong><ul><li><strong>重复执行次数</strong>：Job 管理的 Pod 需要重复执行的次数。</li><li><strong>并行度</strong>：Job 并行执行的 Pod 数量。</li><li><strong>失败重启策略</strong>：Pod下容器异常推出后的重启策略。<ul><li><strong>Never</strong>：不重启容器，直至 Pod 下所有容器退出。</li><li><strong>OnFailure</strong>：Pod 继续运行，容器将重新启动。</li></ul></li></ul></li><li><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</li><li><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</li><li><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</li><li><strong>NFS盘</strong>：挂载外部NFS到Pod，用户需要指定相应NFS地址，格式：127.0.0.1:/data</li><li><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></li><li><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></li><li><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></li><li><strong>实例内容器</strong>：根据实际需求，为 CronJob 的一个 Pod 设置一个或多个不同的容器。<ul><li><strong>名称</strong>：自定义。</li><li><strong>镜像</strong>：根据实际需求进行选择。</li><li><strong>镜像版本（Tag）</strong>：根据实际需求进行填写。</li><li><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性。</li><li><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</li><li><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头<ul><li><p><strong>新增变量</strong>：自己设定变量键值对</p></li><li><p><strong>引用ConfigMap/Secret</strong>：引用已有键值对</p></li><li><p><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。</p></li><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li></ul></li><li><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</li><li><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</li><li><strong>注释（Annotations）</strong>：给Pod添加相应Annotation，如用户信息等</li><li><strong>网络模式</strong>：选择Pod网络模式<ul><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li></ul></li></ul></li><li><p>单击【创建Workload】，完成创建。</p></li></ol><h3 id=查看-cronjob-状态>查看 CronJob 状态</h3><ol><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建CronJob的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【CronJob】管理页面。</li><li>单击需要查看状态的 CronJob 名称，即可查看 CronJob 详情。</li></ol><h2 id=kubectl-操作-cronjob-指引>Kubectl 操作 CronJob 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CronJob</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>schedule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;*/1 * * * *&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jobTemplate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hello</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>args</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>/bin/sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span>- -<span style=color:#000>c</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>date; echo Hello from the Kubernetes cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OnFailure</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li>kind：标识 CronJob 资源类型。</li><li>metadata：CronJob 的名称、Label等基本信息。</li><li>metadata.annotations：对 CronJob 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li><li>spec.schedule：CronJob 执行的 Cron 的策略。</li><li>spec.jobTemplate：Cron 执行的 Job 模板。</li></ul><h3 id=创建-cronjob-1>创建 CronJob</h3><h4 id=方法一>方法一</h4><ol><li><p>参考 <a href=../cronjob#YAMLSample>YAML 示例</a>，准备 CronJob YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 CronJob YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f CronJob YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 cronjob.yaml 的 CronJob YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f cronjob.yaml
</code></pre></div></li></ol><h4 id=方法二>方法二</h4><ol><li><p>通过执行<code>kubectl run</code>命令，快速创建一个 CronJob。</p><p>例如，快速创建一个不需要写完整配置信息的 CronJob，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl run hello --schedule=&#34;*/1 * * * *&#34; --restart=OnFailure --image=busybox -- /bin/sh -c &#34;date; echo Hello&#34;
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get cronjob [NAME]
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME      SCHEDULE    SUSPEND   ACTIVE    LAST SCHEDULE   AGE
cronjob   * * * * *   False     0         &lt;none&gt;          15s
</code></pre></div></li></ol><h3 id=删除-cronjob>删除 CronJob</h3><blockquote><p>!</p><ul><li>执行此删除命令前，请确认是否存在正在创建的 Job，否则执行该命令将终止正在创建的 Job。</li><li>执行此删除命令时，已创建的 Job 和已完成的 Job 均不会被终止或删除。</li><li>如需删除 CronJob 创建的 Job，请手动删除。</li></ul><p>执行以下命令，删除 CronJob。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete cronjob [NAME]
</code></pre></div></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-942ebebfffb5f5766dfc29a3ff54c3d9>1.2.6 - TApp</h1><div class=lead>TApp</div><h2 id=tapp>TApp</h2><p>Kubernetes现有应用类型（如：Deployment、StatefulSet等）无法满足很多非微服务应用的需求，比如：操作（升级、停止等）应用中的指定pod、应用支持多版本的pod。如果要将这些应用改造为适合于这些workload的应用，需要花费很大精力，这将使大多数用户望而却步。</p><p>为解决上述复杂应用管理场景，TKEStack基于Kubernetes CRD开发了一种新的应用类型TAPP，它是一种通用类型的workload，同时支持service和batch类型作业，满足绝大部分应用场景，它能让用户更好的将应用迁移到Kubernetes集群。</p><p>查询<a href=../../../../../key-features/tapp>TApp</a>可查看更多相关信息</p><h2 id=tapp控制台操作指引>TApp控制台操作指引</h2><h3 id=创建-tapp>创建 TApp</h3><blockquote><p>注意：使用前提，在<a href=../../../../platform-console/addon-mgmt/>【扩展组件】</a>安装TApp</p></blockquote><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建TApp的【业务】下相应的【命名空间】，展开【工作负载】下拉项，进入【TApp】管理页面。如下图所示：</li></ul><p><img src=../../../../../../images/tapp-1.png alt></p><ul><li><p>单击【新建】，进入 “新建Workload” 页面。根据实际需求，设置 TApp 参数。关键参数信息如下，其中必填项为<strong>工作负载名</strong>、<strong>实例内容器的名称和镜像</strong>：</p><ul><li><strong>工作负载名</strong>：输入自定义名称。</li><li><strong>标签</strong>：给工作负载添加标签</li><li><strong>命名空间</strong>：根据实际需求进行选择。</li><li><strong>类型</strong>：选择【TApp】。</li><li>节点异常策略<ul><li>迁移，调度策略与Deployment一致，Pod会迁移到新的节点</li><li>不迁移，调度策略与StatefulSel一致，异常pod不会被迁移</li></ul></li><li><strong>数据卷</strong>：根据需求，为负载添加数据卷为容器提供存，目前支持临时路径、主机路径、云硬盘数据卷、文件存储NFS、配置文件、PVC，还需挂载到容器的指定路径中</li><li><strong>临时目录</strong>：主机上的一个临时目录，生命周期和Pod一致</li><li><strong>主机路径</strong>：主机上的真实路径，可以重复使用，不会随Pod一起销毁</li><li><strong>NFS盘</strong>：挂载外部NFS到Pod，用户需要指定相应NFS地址，格式：127.0.0.1:/data</li><li><strong>ConfigMap</strong>：用户在业务Namespace下创建的<a href=../../pei-zhi-guan-li/configmap>ConfigMap</a></li><li><strong>Secret</strong>：用户在业务namespace下创建的<a href=../../pei-zhi-guan-li/secret>Secret</a></li><li><strong>PVC</strong>：用户在业务namespace下创建的<a href=../../cun-chu/pv-he-pvc>PVC</a></li><li><strong>实例内容器</strong>：根据实际需求，为 TApp 的一个 Pod 设置一个或多个不同的容器。<ul><li><strong>名称</strong>：自定义</li><li><strong>镜像</strong>：根据实际需求进行选择<ul><li><p><strong>镜像版本（Tag）</strong>：根据实际需求进行填写，不填默认为<code>latest</code></p></li><li><p><strong>CPU/内存限制</strong>：可根据 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>Kubernetes 资源限制</a> 进行设置 CPU 和内存的限制范围，提高业务的健壮性（<strong>建议使用默认值</strong>）</p></li><li><p><strong>GPU限制</strong>：如容器内需要使用GPU，此处填GPU需求</p></li><li><p><strong>环境变量</strong>：用于设置容器内的变量，变量名只能包含大小写字母、数字及下划线，并且不能以数字开头</p></li><li><p><strong>新增变量</strong>：自己设定变量键值对</p></li><li><p><strong>引用ConfigMap/Secret</strong>：引用已有键值对</p></li><li><p><strong>高级设置</strong>：可设置 “<strong>工作目录</strong>”、“<strong>运行命令</strong>”、“<strong>运行参数</strong>”、“<strong>镜像更新策略</strong>”、“<strong>容器健康检查</strong>”和“<strong>特权级</strong>”等参数。这里介绍一下镜像更新策略。</p></li><li><p><strong>镜像更新策略</strong>：提供以下3种策略，请按需选择</p><p>若不设置镜像拉取策略，当镜像版本为空或 <code>latest</code> 时，使用 Always 策略，否则使用 IfNotPresent 策略</p><ul><li><strong>Always</strong>：总是从远程拉取该镜像</li><li><strong>IfNotPresent</strong>：默认使用本地镜像，若本地无该镜像则远程拉取该镜像</li><li><strong>Never</strong>：只使用本地镜像，若本地没有该镜像将报异常</li></ul></li></ul></li></ul></li><li><strong>实例数量</strong>：根据实际需求选择调节方式，设置实例数量。</li><li><strong>手动调节</strong>：直接设定实例个数</li><li><strong>自动调节</strong>：根据设定的触发条件自动调节实例个数，目前支持根据CPU、内存利用率和利用量出入带宽等调节实例个数</li><li><strong>定时调节</strong>：根据Crontab 语法周期性设置实例个数</li><li><strong>imagePullSecrets</strong>：镜像拉取密钥，用于拉取用户的私有镜像</li><li><strong>节点调度策略</strong>：根据配置的调度规则，将Pod调度到预期的节点。支持指定节点调度和条件选择调度</li><li><strong>注释（Annotations）</strong>：给TApp添加相应Annotation，如用户信息等</li><li><strong>网络模式</strong>：选择Pod网络模式<ul><li><strong>OverLay（虚拟网络）</strong>：基于 IPIP 和 Host Gateway 的 Overlay 网络方案</li><li><strong>FloatingIP（浮动 IP）</strong>：支持容器、物理机和虚拟机在同一个扁平面中直接通过IP进行通信的 Underlay 网络方案。提供了 IP 漂移能力，支持 Pod 重启或迁移时 IP 不变</li><li><strong>NAT（端口映射）</strong>：Kubernetes 原生 NAT 网络方案</li><li><strong>Host（主机网络）</strong>：Kubernetes 原生 Host 网络方案</li></ul></li><li><strong>Service</strong>：勾选【启用】按钮，配置负载端口访问</li></ul><blockquote><p>注意：如果不勾选【启用】则不会创建Service</p></blockquote></li><li><p><strong>服务访问方式</strong>：选择是【仅在集群内部访问】该负载还是集群外部通过【主机端口访问】该负载</p><ul><li><strong>仅在集群内访问</strong>：使用 Service 的 ClusterIP 模式，自动分配 Service 网段中的 IP，用于集群内访问。数据库类等服务如 MySQL 可以选择集群内访问，以保证服务网络隔离</li><li><strong>主机端口访问</strong>：提供一个主机端口映射到容器的访问方式，支持 TCP、UDP、Ingress。可用于业务定制上层 LB 转发到 Node</li><li><strong>Headless Service</strong>：不创建用于集群内访问的ClusterIP，访问Service名称时返回后端Pods IP地址，用于适配自有的服务发现机制。解析域名时返回相应 Pod IP 而不是 Cluster IP</li></ul></li><li><p><strong>端口映射</strong>：输入负载要暴露的端口并指定通信协议类型（<strong>容器和服务端口建议都使用80</strong>）</p></li><li><p><strong>Session Affinity:</strong> 点击【显示高级设置】出现，会话保持，设置会话保持后，会根据请求IP把请求转发给这个IP之前访问过的Pod。默认None，按需使用</p></li><li><p>单击【创建Workload】，完成创建。如下图所示：</p><p>当“运行/期望Pod数量”相等时，即表示 TApp 下的所有 Pod 已创建完成。</p></li></ul><p><img src=../../../../../../images/tapp-2.png alt></p><h3 id=更新-tapp>更新 TApp</h3><h4 id=更新-yaml>更新 YAML</h4><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要更新的【业务】下相应的【命名空间】，展开【工作负载】列表，进入【TApp】管理页面。在需要更新 YAML 的 TApp 行中，单击【更多】>【编辑YAML】，进入“更新 TApp” 页面。如下图所示：</li></ul><p><img src=../../../../../../images/tapp-3.png alt></p><ul><li>在 “更新TApp” 页面，编辑 YAML，单击【完成】，即可更新 YAML。如下图所示：</li></ul><p><img src=../../../../../../images/tapp-4.png alt=&#x66F4;&#x65B0;YAML></p><h3 id=调整-pod-数量>调整 Pod 数量</h3><ul><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择要变更的业务下相应的命名空间，展开工作负载列表，进入 TApp 管理页面。</li><li>点击 TApp 列表操作栏的【更新实例数量】按钮。如下图所示：</li></ul><p><img src=../../../../../../images/tapp-5.png alt></p><ul><li>根据实际需求调整 Pod 数量，如3，单击页面下方的【更新实例数目】即可完成调整。</li></ul><h3 id=tapp特色功能-指定pod灰度升级>TApp特色功能-指定pod灰度升级</h3><ul><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择要变更的业务下相应的【命名空间】，展开【工作负载】列表，进入【 TApp】 管理页面，点击进入要灰度升级的 TApp名称。如下图所示：</li></ul><p><img src=../../../../../../images/tapp-6.png alt></p><ul><li>如下图标签1所示，可选指定需要灰度升级的pod，然后点击下图中标签2 的【灰度升级】即可升级指定pod。</li></ul><p><img src=../../../../../../images/tapp-7.png alt></p><ul><li><p>在弹出的 “回滚资源” 提示框中，单击【确定】即可完成回滚。</p><blockquote><p>注意：此页面同时可完成指定Pod监控和删除</p></blockquote></li></ul><p>查询<a href=../../../../../key-features/tapp>TApp</a>可查看更多相关信息</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8f31787affb2101a550d608ac7166151>1.2.7 - 工作负载的请求与限制</h1><div class=lead>工作负载的请求与限制</div><h2 id=工作负载的请求与限制>工作负载的请求与限制</h2><p><strong>Request</strong>：容器使用的最小资源需求，作为容器调度时资源分配的判断依赖。只有当节点上可分配资源量 >= 容器资源请求数时才允许将容器调度到该节点。但 Request 参数不限制容器的最大可使用资源值。 <strong>Limit</strong>： 容器能使用的资源最大值。</p><blockquote><p>! 更多 <strong>Limit</strong> 和 <strong>Request</strong> 参数介绍，单击 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>查看详情</a>。</p></blockquote><h2 id=cpu-限制说明>CPU 限制说明</h2><p>CPU 资源允许设置 CPU 请求和 CPU 限制的资源量，以核（U）为单位，允许为小数。</p><blockquote><p>!</p><ul><li>CPU Request 作为调度时的依据，在创建时为该容器在节点上分配 CPU 使用资源，称为 “已分配 CPU” 资源。</li><li>CPU Limit 限制容器 CPU 资源的上限，不设置表示不做限制（CPU Limit >= CPU Request）。</li></ul></blockquote><h2 id=内存限制说明>内存限制说明</h2><p>内存资源只允许限制容器最大可使用内存量。以 MiB 为单位，允许为小数。</p><blockquote><p>!</p><ul><li>内存 Request 作为调度时的依据，在创建时为该容器在节点上分配内存，称为 “已分配内存” 资源。</li><li>内存资源为不可伸缩资源。当节点上所有容器使用内存均超量时，存在 OOM 的风险。因此不设置 Limit 时，默认 Limit = Request，保证容器的正常运作。</li></ul></blockquote><h2 id=cpu-使用量和-cpu-使用率>CPU 使用量和 CPU 使用率</h2><ul><li>CPU 使用量为绝对值，表示实际使用的 CPU 的物理核数，CPU 资源请求和 CPU 资源限制的判断依据都是 CPU 使用量。</li><li>CPU 使用率为相对值，表示 CPU 的使用量与 CPU 单核的比值（或者与节点上总 CPU 核数的比值）。</li></ul><h2 id=使用示例>使用示例</h2><p>一个简单的示例说明 Request 和 Limit 的作用，测试集群包括1个 4U4G 的节点、已经部署的两个 Pod ( Pod1，Pod2 )，每个 Pod 的资源设置为（CPU Requst，CPU Limit，Memory Requst，Memory Limit）=（1U，2U，1G，1G）。（1.0G = 1000MiB） 节点上 CPU 和内存的资源使用情况如下图所示： <img src=https://mc.qcloudimg.com/static/img/b021e644c31ddcacf13930a412c51e5a/image.png alt="Alt text"> 已经分配的 CPU 资源为：1U（分配 Pod1） + 1U（分配 Pod2） = 2U，剩余可以分配的 CPU 资源为2U。 已经分配的内存资源为：1G（分配 Pod1） + 1G（分配 Pod2） = 2G，剩余可以分配的内存资源为2G。 所以该节点可以再部署一个 ( CPU Requst， Memory Requst ) =( 2U，2G )的 Pod 部署，或者部署2个（CPU Requst，Memory Requst） = （1U，1G） 的 Pod 部署。</p><p>在资源限制方面，每个 Pod1 和 Pod2 使用资源的上限为 ( 2U，1G )，即在资源空闲的情况下，Pod 使用 CPU 的量最大能达到2U。</p><h2 id=服务资源限制推荐>服务资源限制推荐</h2><p>CCS 会根据您当前容器镜像的历史负载来推荐 Request 与 Limit 值，使用推荐值会保证您的容器更加平稳的运行，大大减小出现异常的概率。</p><p><strong>推荐算法</strong>： 我们首先会取出过去7天当前容器镜像分钟级别负载，并辅以百分位统计第95%的值来最终确定推荐的 Request，Limit 为 Request 的2倍。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Request = Percentile(实际负载[7d],0.95)
Limit = Request * 2
</code></pre></div><p>如果当前的样本数量（实际负载）不满足推荐计算的数量要求，我们会相应的扩大样本取值范围，尝试重新计算。例如，去掉镜像 tag，namespace，serviceName 等筛选条件。若经过多次计算后同样未能得到有效值，则推荐值为空。</p><p><strong>推荐值为空</strong>： 在使用过程中，您会发现有部分值暂无推荐的情况，可能由于以下几点造成： 1. 当前数据并不满足计算的需求，我们需要待计算的样本数量（实际负载）大于1440个，即有一天的数据。 2. 推荐值小于您当前容器已经配置的 Request 或者 Limit。</p><blockquote><p>! 1. 由于推荐值是根据历史负载来计算的，原则上，容器镜像运行真实业务的时间越长，推荐的值越准确。 2. 使用推荐值创建服务，可能会因为集群资源不足造成容器无法调度成功。在保存时，须确认当前集群的剩余资源。 3. 推荐值是建议值，您可以根据自己业务的实际情况做相应的调整。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-728de0d6037af6e8c4dd3d3cd18a58aa>1.3 - 服务</h1><div class=lead>服务</div><h1 id=服务>服务</h1></div><div class=td-content><h1 id=pg-c01661de03c27cf20d354588e9284d09>1.3.1 - Service</h1><div class=lead>Service</div><p>Service 定义访问后端 Pod 的访问方式，并提供固定的虚拟访问 IP。您可以在 Service 中通过设置来访问后端的 Pod，不同访问方式的服务可提供不同网络能力。 腾讯云容器服务（TKE）提供以下四种服务访问方式：</p><table><thead><tr><th style=text-align:left>&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;</th><th style=text-align:left>&#x8BF4;&#x660E;</th></tr></thead><tbody><tr><td style=text-align:left>&#x4EC5;&#x5728;&#x96C6;&#x7FA4;&#x5185;&#x8BBF;&#x95EE;</td><td style=text-align:left><ul><li>&#x4F7F;&#x7528; Service &#x7684; ClusterIP &#x6A21;&#x5F0F;&#xFF0C;&#x81EA;&#x52A8;&#x5206;&#x914D;
Service &#x7F51;&#x6BB5;&#x4E2D;&#x7684; IP&#xFF0C;&#x7528;&#x4E8E;&#x96C6;&#x7FA4;&#x5185;&#x8BBF;&#x95EE;&#x3002;&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x7B49;&#x670D;&#x52A1;&#x5982;
MySQL &#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x96C6;&#x7FA4;&#x5185;&#x8BBF;&#x95EE;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x670D;&#x52A1;&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x3002;</li><li>&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<b>&#x670D;&#x52A1;&#x540D; + &#x670D;&#x52A1;&#x7AEF;&#x53E3;</b>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</li></ul></td></tr><tr><td style=text-align:left>&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;</td><td style=text-align:left><ul><li>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x5230;&#x5BB9;&#x5668;&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#xFF0C;&#x652F;&#x6301;
TCP&#x3001;UDP&#x3001;Ingress&#x3002;&#x53EF;&#x7528;&#x4E8E;&#x4E1A;&#x52A1;&#x5B9A;&#x5236;&#x4E0A;&#x5C42;
LB &#x8F6C;&#x53D1;&#x5230; Node&#x3002;</li><li>&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<b>&#x4E91;&#x670D;&#x52A1;&#x5668; IP+&#x4E3B;&#x673A;&#x7AEF;&#x53E3;</b>&#x6216;<b>&#x670D;&#x52A1;&#x540D; + &#x670D;&#x52A1;&#x7AEF;&#x53E3;</b>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</li></ul></td></tr></tbody></table><blockquote><p>集群内进行 Service 访问时，建议不要通过负载均衡 IP 进行访问，以避免出现访问不通的情况。</p></blockquote><p>一般情况下，4层负载均衡（LB）会绑定多台 Node 作为 real server（rs） ，使用时需要限制 client 和 rs 不能存在于同一台云服务器上，否则会有一定概率导致报文回环出不去。 当 Pod 去访问 LB 时，Pod 就是源 IP，当其传输到内网时 LB 也不会做 snat 处理将源 IP 转化成 Node IP，那么 LB 收到报文也就不能判断是从哪个 Node 发送的，LB 的避免回环策略也就不会生效，所有的 rs 都可能被转发。当转发到 client 所在的 Node 上时，LB 就无法收到回包，从而导致访问不通。</p><p>集群内访问时，支持Headless Service，解析服务名时直接返回对应Pod IP而不是Cluster IP，可以适配自有的服务发现机制。 两种访问方式均支持Session Affinity，设置会话保持后，会根据请求IP把请求转发给这个IP之前访问过的Pod.</p><h2 id=service-控制台操作指引>Service 控制台操作指引</h2><h3 id=创建-service>创建 Service</h3><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建 Service 的【业务】下相应的【命名空间】，展开【服务】列表，进入【Service】管理页面。</li><li>单击【新建】，进入 “新建 Service” 页面。如下图所示：</li></ul><p><img src=../../../../../../images/image%20%28133%29.png alt></p><ul><li>根据实际需求，设置 Service 参数。关键参数信息如下：<ul><li>服务名称：自定义。</li><li>命名空间：根据实际需求进行选择。</li><li>访问设置：请参考 <a href=../service#%E7%AE%80%E4%BB%8B>简介</a> 并根据实际需求进行设置。</li></ul></li><li>单击【创建服务】，完成创建。</li></ul><h3 id=更新-service>更新 Service</h3><h4 id=更新-yaml>更新 YAML</h4><ol><li>登录TKEStack，切换到业务管理控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建Service的业务下相应的命名空间，展开服务列表，进入Service管理页面。</li><li>在需要更新 YAML 的 Service 行中，单击【编辑YAML】，进入更新 Service 页面。</li><li>在 “更新Service” 页面，编辑 YAML，单击【完成】，即可更新 YAML。</li></ol><h2 id=kubectl-操作-service-指引>Kubectl 操作 Service 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyApp</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>9376</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li>kind：标识 Service 资源类型。</li><li>metadata：Service 的名称、Label等基本信息。</li><li>spec.type：标识 Service 的被访问形式<ul><li>ClusterIP：在集群内部公开服务，可用于集群内部访问。</li><li>NodePort：使用节点的端口映射到后端 Service，集群外可以通过节点 IP:NodePort 访问。</li><li>LoadBalancer：使用腾讯云提供的负载均衡器公开服务，默认创建公网 CLB， 指定 annotations 可创建内网 CLB。</li><li>ExternalName：将服务映射到 DNS，仅适用于 kube-dns1.7及更高版本。</li></ul></li></ul><h3 id=创建-service-1>创建 Service</h3><ol><li><p>参考 <a href=../service#YAMLSample>YAML 示例</a>，准备 StatefulSet YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 Service YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f Service YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 my-service.yaml 的 Service YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f my-service.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get services
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   172.16.255.1   &lt;none&gt;        443/TCP   38d
</code></pre></div></li></ol><h3 id=更新-service-1>更新 Service</h3><h4 id=方法一>方法一</h4><p>执行以下命令，更新 Service。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl edit service/[name]
</code></pre></div><h4 id=方法二>方法二</h4><ol><li><p>手动删除旧的 Service。</p></li><li><p>执行以下命令，重新创建 Service。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create/apply
</code></pre></div></li></ol><h3 id=删除-service>删除 Service</h3><p>执行以下命令，删除 Service。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl delete service [NAME]
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>.params{margin-bottom:0px !important;}  
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-633c3237aaeb2d075e5d341846481ed4>1.3.2 - Ingress</h1><div class=lead>Ingress</div><p>Ingress 是允许访问到集群内 Service 的规则的集合，您可以通过配置转发规则，实现不同 URL 可以访问到集群内不同的 Service。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-789101fc549a9485b823279e9954eed5>1.4 - 配置管理</h1><div class=lead>配置管理</div><h1 id=配置管理>配置管理</h1></div><div class=td-content><h1 id=pg-0c72d80fcd8fcfd427fcdb7f64153f05>1.4.1 - ConfigMap</h1><div class=lead>ConfigMap</div><p>通过 ConfigMap 您可以将配置和运行的镜像进行解耦，使得应用程序有更强的移植性。ConfigMap 是有 key-value 类型的键值对，您可以通过控制台的 Kubectl 工具创建对应的 ConfigMap 对象，可以通过挂载数据卷、环境变量或在容器的运行命令中使用 ConfigMap。 ConfigMap 有两种使用方式，创建负载时做为数据卷挂载到容器和作为环境变量映射到容器。</p><h2 id=configmap-控制台操作指引>ConfigMap 控制台操作指引</h2><h3 id=创建-configmap>创建 ConfigMap</h3><ul><li>登录TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建ConfigMap的【业务】下相应的【命名空间】，展开【配置管理】列表，进入ConfigMap管理页面。</li><li>单击【新建】，进入 “新建ConfigMap” 页面。如下图所示：</li></ul><p><img src=../../../../../../images/new-config-map.png alt=&#x65B0;&#x5EFA;ConfigMap></p><ul><li>根据实际需求，设置 ConfigMap 参数。关键参数信息如下：<ul><li>名称：自定义。</li><li>命名空间：根据实际需求进行选择命名空间类型</li><li>定义变量名和变量值。</li></ul></li><li>单击【创建ConfigMap】，完成创建。</li></ul><h3 id=更新-configmap>更新 ConfigMap</h3><ol><li><p>登录TKEStack，切换到业务管理控制台，选择左侧导航栏中的【应用管理】。</p></li><li><p>选择需要创建ConfigMap的业务下相应的命名空间，展开配置管理列表，进入ConfigMap管理页面。</p></li><li><p>在需要更新 YAML 的 ConfigMap 行中，单击【编辑YAML】，进入更新 ConfigMap 页面。</p></li><li><p>在 “更新ConfigMap” 页面，编辑 YAML，单击【完成】，即可更新 YAML。</p><blockquote><p>如需修改 key-values，编辑 YAML 中 data 的参数值，单击【完成】，即可完成更新。</p></blockquote></li></ol><h2 id=kubectl-操作-configmap-指引>Kubectl 操作 ConfigMap 指引</h2><h3 id=yaml-示例>YAML 示例</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>key1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>key2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value2</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>key3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value3</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><ul><li>data：ConfigMap 的数据，以 key-value 形式呈现。</li><li>kind：标识 ConfigMap 资源类型。</li><li>metadata：ConfigMap 的名称、Label等基本信息。</li><li>metadata.annotations：ConfigMap 的额外说明，可通过该参数设置腾讯云 TKE 的额外增强能力。</li></ul><h3 id=创建-configmap-1>创建 ConfigMap</h3><h4 id=方式一通过-yaml-示例文件方式创建>方式一：通过 YAML 示例文件方式创建</h4><ol><li><p>参考 <a href=../configmap#YAMLSample>YAML 示例</a>，准备 ConfigMap YAML 文件。</p></li><li><p>安装 Kubectl，并连接集群。操作详情请参考 <a href=https://cloud.tencent.com/document/product/457/8438>通过 Kubectl 连接集群</a>。</p></li><li><p>执行以下命令，创建 ConfigMap YAML 文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f ConfigMap YAML 文件名称
</code></pre></div><p>例如，创建一个文件名为 web.yaml 的 ConfigMap YAML 文件，则执行以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create -f web.yaml
</code></pre></div></li><li><p>执行以下命令，验证创建是否成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl get configmap
</code></pre></div><p>返回类似以下信息，即表示创建成功。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME          DATA      AGE
test          2         39d
test-config   3         18d
</code></pre></div></li></ol><h4 id=方式二通过执行命令方式创建>方式二：通过执行命令方式创建</h4><p>执行以下命令，在目录中创建 ConfigMap。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;
</code></pre></div><ul><li>&lt;map-name>：表示 ConfigMap 的名字。</li><li>&lt;data-source>：表示目录、文件或者字面值。</li></ul><p>更多参数详情可参见 <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#create-a-configmap>Kubernetes configMap 官方文档</a>。</p><h3 id=使用-configmap>使用 ConfigMap</h3><h4 id=方式一数据卷使用-configmap-类型>方式一：数据卷使用 ConfigMap 类型</h4><p>YAML 示例如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config-volume</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/config</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config-volume</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>configMap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置 ConfigMap 来源</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>## items:  ## 设置指定 ConfigMap 的 Key 挂载</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>##   key: key1  ## 选择指定 Key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>##   path: keys ## 挂载到指定的子路径</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=方式二环境变量中使用-configmap-类型>方式二：环境变量中使用 ConfigMap 类型</h4><p>YAML 示例如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>         </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>key1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>valueFrom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>configMapKeyRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置来源 ConfigMap 文件名</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-config.key1 </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置该环境变量的 Value 来源项</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5a27b72a9f3556b1c20ff0496d3c3d0e>1.4.2 - Sercet</h1><div class=lead>Sercet</div><h2 id=sercet>Sercet</h2><p>Secret 可用于存储密码、令牌、密钥等敏感信息，降低直接对外暴露的风险。Secret 是 key-value 类型的键值对，您可以通过控制台的 Kubectl 工具创建对应的 Secret 对象，也可以通过挂载数据卷、环境变量或在容器的运行命令中使用 Secret。</p><h2 id=secret-控制台操作指引>Secret 控制台操作指引</h2><h3 id=创建-secret>创建 Secret</h3><ul><li>登录 TKEStack，切换到【业务管理】控制台，选择左侧导航栏中的【应用管理】。</li><li>选择需要创建 Secret 的【业务】下相应的【命名空间】，展开【配置管理】列表，进入 Secret 管理页面。</li><li>单击【新建】，进入“新建 Secret ”页面。</li><li>在“新建 Secret ”页面，根据实际需求，进行如下参数设置。如下图所示：</li></ul><p><img src=../../../../../../images/secret.png alt></p><ul><li><strong>名称</strong>：请输入自定义名称。</li><li><strong>Secret类型</strong>：提供【Opaque】和【Dockercfg】两种类型，请根据实际需求进行选择。<ul><li><strong>Opaque</strong>：适用于保存秘钥证书和配置文件，Value 将以 base64 格式编码。</li><li><strong>Dockercfg</strong>：适用于保存私有 Docker Registry 的认证信息。</li></ul></li><li><strong>生效范围</strong>：提供以下两种范围，请根据实际需求进行选择。<ul><li><strong>存量所有命名空间</strong>：不包括 kube-system、kube-public 和后续增量命名空间。</li><li><strong>指定命名空间</strong>：支持选择当前集群下一个或多个可用命名空间。</li></ul></li><li><strong>内容</strong>：根据不同的 Secret 类型，进行配置。<ul><li>当 Secret 类型为【Opaque】时：根据实际需求，设置变量名和变量值。</li><li>当 Secret 类型为【Dockercfg】时：<ul><li><p>仓库域名：请根据实际需求输入域名或 IP。</p></li><li><p>用户名：请根据实际需求输入第三方仓库的用户名。</p></li><li><p>密码：请根据实际需求设置第三方仓库的登录密码。</p><blockquote><p>如果本次为首次登录系统，则会新建用户，相关信息写入 <code>~/.dockercrg</code> 文件中。</p></blockquote></li></ul></li></ul></li><li>单击【创建 Secret】，即可完成创建。</li></ul><h3 id=使用-secret>使用 Secret</h3><blockquote><p>Secret 在 Workload中有三种使用场景： 1. 数据卷使用 Secret 类型 2. 环境变量中使用 Secret 类型 3. 使用第三方镜像仓库时引用</p></blockquote><h3 id=更新-secret>更新 Secret</h3><ol><li><p>登录 TKEStack，切换到业务管理控制台，选择左侧导航栏中的【应用管理】。</p></li><li><p>选择需要创建 Secret 的业务下相应的命名空间，展开配置管理列表，进入 Secret 管理页面。</p></li><li><p>在需要更新 YAML 的 Secret 行中，单击【编辑YAML】，进入更新 Secret 页面。</p></li><li><p>在“更新Secret”页面，编辑 YAML，并单击【完成】即可更新 YAML。</p><blockquote><p>如需修改 key-values，则编辑 YAML 中 data 的参数值，并单击【完成】即可完成更新。</p></blockquote></li></ol><h2 id=kubectl-操作-secret-指引>Kubectl 操作 Secret 指引</h2><h3 id=创建-secret-1>创建 Secret</h3><h4 id=方式一通过指定文件创建-secret>方式一：通过指定文件创建 Secret</h4><ol><li><p>依次执行以下命令，获取 Pod 的用户名和密码。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ echo -n &#39;username&#39; &gt; ./username.txt
$ echo -n &#39;password&#39; &gt; ./password.txt
</code></pre></div></li><li><p>执行 Kubectl 命令，创建 Secret。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ kubectl create secret generic test-secret --from-file=./username.txt --from-file=./password.txt
secret &#34;testSecret&#34; created
</code></pre></div></li><li><p>执行以下命令，查看 Secret 详情。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>kubectl describe secrets/ test-secret
</code></pre></div></li></ol><h4 id=方式二yaml-文件手动创建>方式二：YAML 文件手动创建</h4><blockquote><p>? 通过 YAML 手动创建 Secret，需提前将 Secret 的 data 进行 Base64 编码。</p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Opaque</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dXNlcm5hbWU= </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 由echo -n &#39;username&#39; | base64生成</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cGFzc3dvcmQ= </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 由echo -n &#39;password&#39; | base64生成</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h3 id=使用-secret-1>使用 Secret</h3><h4 id=方式一-数据卷使用-secret-类型>方式一： 数据卷使用 Secret 类型</h4><p>YAML 示例如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secret-volume</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/config</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secret-volume</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>test-secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置 secret 来源</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>## items:  ## 设置指定 secret的 Key 挂载</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>##   key: username  ## 选择指定 Key</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>##   path: group/user ## 挂载到指定的子路径</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic>##   mode: 256  ## 设置文件权限</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=方式二-环境变量中使用-secret-类型>方式二： 环境变量中使用 Secret 类型</h4><p>YAML 示例如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>         </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SECRET_USERNAME</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#204a87;font-weight:700>valueFrom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>             </span><span style=color:#204a87;font-weight:700>secretKeyRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置来源 Secret 文件名</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置该环境变量的 Value 来源项</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=方法三使用第三方镜像仓库时引用>方法三：使用第三方镜像仓库时引用</h4><p>YAML 示例如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Pod</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>     </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>imagePullSecrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>test-secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## 设置来源 Secret 文件名</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5133b2fd66402e8287da92f8bc3afb8a>1.5 - 存储</h1><div class=lead>存储</div><h1 id=存储>存储</h1></div><div class=td-content><h1 id=pg-29f3e5641963f81595c61e48c46454d2>1.5.1 - PV和PVC</h1><div class=lead>PV和PVC</div><p>PersistentVolume（PV）：集群内的存储资源。例如，节点是集群的资源。PV 独立于 Pod 的生命周期，根据不同的 StorageClass 类型创建不同类型的 PV。 PersistentVolumeClaim（PVC）：集群内的存储请求。例如，PV 是 Pod 使用节点资源，PVC 则声明使用 PV 资源。当 PV 资源不足时，PVC 也可以动态创建 PV。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1ac5657bc83221fe31967a09022efbb7>1.5.2 - StorageClass</h1><div class=lead>StorageClass</div><p>StorageClass 描述存储的类型，集群管理员可以为集群定义不同的存储类别。可通过 StorageClass 配合 PersistentVolumeClaim 可以动态创建需要的存储资源。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c2e6b2266588f17239be429af65c27b>1.6 - 事件</h1><div class=lead>事件</div><p>日志针对的是容器。包括了 Kuberntes 集群的运行容器的日志情况和各类资源的调度情况，对维护人员日常观察资源的变更以及定位问题均有帮助。</p><h2 id=日志控制台操作指引>日志控制台操作指引</h2><ul><li>登录 TKEStack，切换到【业务管理】控制台，点击【应用管理】，选择【日志】。</li><li>进入“日志”页面。</li><li>可以按照不用的命名空间和资源类型进行筛选。</li></ul><p><img src=../../../../../images/image%20%2869%29.png alt></p><blockquote><p>注意：Kubernetes 默认只将最近一个小时的事件存储在 ETCD 中，若想实现事件的持久化存储和查询操作</p></blockquote><blockquote><p>您可以参考 <a href=https://github.com/tkestack/tke/blob/master/hack/addon/readme/PersistentEvent.md>事件持久化</a> 将事件导入外部存储，实现事件的持久化存储</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-14f8919cb8baa3bde4981e98721ae227>1.7 - 日志</h1><div class=lead>日志</div><p>时间针对的是负载。Kubernetes Events 包括了 Kuberntes 集群的运行和各类资源的调度情况，对维护人员日常观察资源的变更以及定位问题均有帮助。</p><h2 id=event-控制台操作指引>Event 控制台操作指引</h2><ul><li>登录 TKEStack，切换到【业务管理】控制台，点击【应用管理】中的【事件】，进入“事件”页面。</li><li>可以按照不用的命名空间和资源类型进行筛选。</li></ul><p><img src=../../../../../images/image%20%28122%29.png alt></p><p>您可以参考 <a href=../../operation-mgmt/log-collection>日志采集</a> 将日志导入外部存储，实现日志的高级管理。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3057610a99f7aa499109de1965002074>2 - 业务管理</h1><div class=lead>业务管理</div><p><strong>这里用户可以管理业务。</strong></p><h2 id=更改业务成员>更改业务成员</h2><ol><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，点击【业务管理】。</p></li><li><p>在“业务管理”页面中，可以看到已创建的业务列表。鼠标移动到要修改的业务上(无需点击)，成员列会出现修改图标按钮。如下图所示： <img src=../../../../images/%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E6%88%90%E5%91%98%E5%9B%BE%E6%A0%871.png alt=&#x4FEE;&#x6539;&#x56FE;&#x6807;&#x6309;&#x94AE;></p><blockquote><p>注意：修改业务成员仅限状态为Active的业务，这里可以新建和删除成员。</p></blockquote></li></ol><h2 id=查看业务监控>查看业务监控</h2><ol><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，点击【业务管理】。</p></li><li><p>在“业务管理”页面中，可以看到已创建的业务列表。点击监控按钮，如下图所示：</p><p><img src=../../../../images/%E6%9F%A5%E7%9C%8B%E4%B8%9A%E5%8A%A1%E7%9B%91%E6%8E%A71.png alt=&#x76D1;&#x63A7;&#x6309;&#x94AE;></p></li><li><p>在右侧弹出窗口里查看业务监控情况，如下图所示：</p><p><img src=../../../../images/%E4%B8%9A%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%AF%A6%E6%83%851.png alt=&#x4E1A;&#x52A1;&#x76D1;&#x63A7;&#x8BE6;&#x60C5;></p></li></ol><h2 id=删除业务>删除业务</h2><ol><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，点击【业务管理】。</p></li><li><p>在“业务管理”页面中，可以看到已创建的业务列表。点击删除按钮，如下图所示：</p><p><img src=../../../../images/%E5%88%A0%E9%99%A4%E4%B8%9A%E5%8A%A11.png alt=&#x5220;&#x9664;&#x4E1A;&#x52A1;></p><blockquote><p>注意：删除业务成员仅限状态为Active的业务</p></blockquote></li></ol><h2 id=对业务的操作>对业务的操作</h2><ul><li>登录 TKEStack。</li><li>在【业务管理】控制台的【业务管理】中，单击【业务id】。如下图所示：</li></ul><p><img src=../../../../images/businessid1.png alt=&#x4E1A;&#x52A1;id></p><p>a. <strong>业务信息：</strong> 在这里可以对业务名称、关联的集群、关联集群的资源进行限制等操作。</p><p><img src=../../../../images/%E4%B8%9A%E5%8A%A1%E4%BF%A1%E6%81%AF1.png alt=&#x4E1A;&#x52A1;&#x4FE1;&#x606F;></p><p>b. <strong>成员列表：</strong> 在这里可以对业务名称、关联的集群、关联集群的资源进行限制等操作。</p><p><img src=../../../../images/%E6%88%90%E5%91%98%E5%88%97%E8%A1%A8%E8%AE%BE%E7%BD%AE.png alt=&#x4E1A;&#x52A1;&#x4FE1;&#x606F;></p><p>c. <strong>子业务：</strong> 在这里可以<strong>新建本业务的子业务</strong>或<strong>通过导入子业务将已有业务变成本业务的子业务</strong></p><p><img src=../../../../images/%E5%AD%90%E4%B8%9A%E5%8A%A1.png alt=&#x4E1A;&#x52A1;&#x4FE1;&#x606F;></p><p>d. <strong>业务下Namespace列表：</strong> 这里可以管理业务下的Namespace</p><p><img src=../../../../images/%E4%B8%9A%E5%8A%A1Namespace%E5%88%97%E8%A1%A8.png alt=&#x4E1A;&#x52A1;&#x4FE1;&#x606F;></p><p>​ 单击【新建Namespace】。在“新建Namespace”页面中，填写相关信息。如下图所示：</p><p><img src=../../../../images/my-ns.png alt=&#x65B0;&#x5EFA;&#x7A7A;&#x95F4;&#x5217;&#x8868;></p><p>​ <strong>名称</strong>：不能超过63个字符，这里以<code>new-ns</code>为例</p><p>​ <strong>集群</strong>：<code>my-business</code>业务中的集群，这里以<code>global</code>集群为例</p><p>​ <em>资源限制*</em>：这里可以限制当前命名空间下各种资源的使用量，可以不设置。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0833d65e8a0923cb315f467023b013b7>3 - 组织资源</h1><div class=lead>组织资源</div><h1 id=组织资源>组织资源</h1></div><div class=td-content><h1 id=pg-f5322afb855665547246929ce62f630e>3.1 - 镜像仓库管理</h1><div class=lead>镜像仓库管理</div><p><strong>这里用户可以管理镜像仓库。</strong></p><blockquote><p>注意：TKEStack的【业务管理】控制台不支持命名空间的创建，可以在【平台管理】下的<a href=../../../platform-console/registry-mgmt/>【组织资源】</a>下的【镜像仓库管理】新建命名空间。</p></blockquote><h2 id=删除命名空间>删除命名空间</h2><ol><li>登录 TKEStack。</li><li>切换至 【业务管理】控制台，选择 【组织资源】->【仓库管理】。点击列表最右侧【删除】按钮。如下图所示：</li><li>点击【确认】</li></ol><p><img src=../../../../../images/ming-ming-kong-jian-shan-chu-an-niu-1.png alt></p><h3 id=镜像上传>镜像上传</h3><ul><li>登录 TKEStack。</li><li>切换至 【业务管理】控制台，选择 【组织资源】->【仓库管理】，查看“命名空间”列表。点击列表中命名空间【名称】。如下图所示：</li></ul><p><img src=../../../../../images/image%20%28104%29.png alt></p><ul><li><p>此时进入了“镜像列表”页面，点击【镜像上传指引】按钮。如下图所示：</p><blockquote><p>注意：此页面可以通过上传的镜像最右边的【删除】按钮来删除上传的镜像</p></blockquote></li></ul><p><img src=../../../../../images/image%20%2858%29.png alt></p><ul><li>根据指引内容，在物理节点上执行相应命令。如下图所示：</li></ul><p><img src=../../../../../images/image%20%2883%29.png alt></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f0a95e137c43ada900e73e5db88f8ac3>3.2 - Helm模板</h1><div class=lead>Helm模板</div><p>应用功能是 TKEStack 集成的 <a href=https://helm.sh/>Helm 3.0</a> 相关功能，为您提供创建 helm chart、容器镜像、软件服务等各种产品和服务的能力。已创建的应用将在您指定的集群中运行，为您带来相应的能力。</p><h2 id=模板>模板</h2><ol><li><p>登录 TKEStack</p></li><li><p>切换至 【平台管理】控制台，选择 【组织资源】->【 Helm模板】，点击【模板】 1. <strong>所有模板</strong>：包含下列所有模板 2. <strong>用户模板</strong>：权限范围为“指定用户”的仓库下的所有模板 3. <strong>业务模板</strong>：权限范围为“指定业务”的仓库下的所有模板 4. <strong>公共模板</strong>：权限范围为“公共”的仓库下的所有模板</p><p><img src=../../../../../images/image-20201203144524973.png alt=image-20201203144524973></p></li></ol><h2 id=仓库>仓库</h2><ol><li><p>登录 TKEStack</p></li><li><p>切换至 【平台管理】控制台，选择 【组织资源】->【 Helm模板】，点击【仓库】</p></li><li><p>点击【新建】按钮，如下图所示： <img src=../../../../../images/Chart%E5%8C%85%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png alt=&#x65B0;&#x5EFA;Chart&#x5305;&#x547D;&#x540D;&#x7A7A;&#x95F4;></p><ul><li><p>在弹出的 “新建仓库” 页面，填写 仓库 信息，如下图所示：</p><p><img src=../../../../../images/image-20201203144754466.png alt=image-20201203144754466></p></li><li><p><strong>仓库名称：</strong> 仓库名字，不超过60个字符</p></li><li><p><strong>权限访问</strong></p><ul><li><strong>指定用户</strong>：选择当前仓库可以被哪些平台的用户访问</li><li><strong>指定业务</strong>：选择当前仓库可以被哪些平台的业务访问，业务下的成员对该仓库的访问权限在【业务管理】中完成</li><li><strong>公共</strong>：平台所有用户都能访问该仓库</li></ul></li><li><p><strong>导入第三方仓库：</strong> 若已有仓库想导入 TKEStack 中使用，请勾选</p><ul><li><strong>第三方仓库地址</strong>：请输入第三方仓库地址</li><li><strong>第三方仓库用户名</strong>：若第三方仓库开启了鉴权，需要输入第三方仓库的用户名</li><li><strong>第三方仓库密码</strong>：若第三方仓库开启了鉴权，需要输入第三方仓库的密码</li></ul></li><li><p><strong>仓库描述：</strong> 请输入仓库描述，不超过255个字符</p></li></ul></li><li><p>单击【确认】按钮</p><p><strong>删除仓库</strong></p></li><li><p>登录 TKEStack</p></li><li><p>切换至 【平台管理】控制台，选择 【组织资源】-> 【 Helm 模板】，点击【仓库】，查看 “helm模板仓库”列表</p></li><li><p>点击列表最右侧【删除】按钮，如下图所示：</p><p><img src=../../../../../images/Chart%E5%8C%85%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%88%A0%E9%99%A4%E6%8C%89%E9%92%AE%20%281%29.png alt=Chart&#x5305;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5220;&#x9664;&#x6309;&#x94AE;></p><p><strong>Chart 上传指引</strong></p></li><li><p>登录 TKEStack</p></li><li><p>切换至 【平台管理】控制台，选择 【组织资源】-> 【 Helm模板】，点击【仓库】，查看 “helm模板仓库”列表</p></li><li><p>点击列表最右侧【上传指引】按钮，如下图所示：</p><p><img src=../../../../../images/Chart%E5%8C%85%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%90%8D%E7%A7%B0%20%281%29.png alt=Chart&#x5305;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x540D;&#x79F0;></p></li><li><p>根据指引内容，在物理节点上执行相应命令，如下图所示：</p><p><img src=../../../../../images/Chart%E4%B8%8A%E4%BC%A0%E6%8C%87%E5%BC%95%E5%86%85%E5%AE%B9.png alt=Chart&#x4E0A;&#x4F20;&#x6307;&#x5F15;&#x5185;&#x5BB9;></p></li></ol><h2 id=同步导入仓库>同步导入仓库</h2><ol><li><p>登录 TKEStack</p></li><li><p>切换至 【平台管理】控制台，选择 【组织资源】->【 Helm模板】，点击【仓库】</p></li><li><p>点击导入仓库的【同步仓库】按钮，如下图所示：</p><p><img src=../../../../../images/image-20201203151341971.png alt=image-20201203151341971></p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-c94ea67b479a34ed1633b3f44f2a27d9>3.3 - 访问凭证</h1><div class=lead>访问凭证</div><p><strong>这里用户可以管理自己的凭据。</strong></p><h2 id=新建访问凭证>新建访问凭证</h2><ol><li>登录 TKEStack。</li><li>切换至 【业务管理】控制台，选择【组织资源】->【访问凭证】，点击【新建】按钮。</li><li>在弹出“创建访问凭证”页面，填写凭证信息。如下图所示：</li></ol><ul><li>凭证描述：描述当前凭证信息</li><li>过期时间：填写过期时间，选择小时/分钟为单位</li></ul><ol><li>单击【确认】按钮</li></ol><p><img src=../../../../../images/xin-jian-fang-wen-ping-zheng-resource.png alt></p><p><img src=../../../../../images/xin-jian-fang-wen-ping-zheng-resource1.png alt></p><h2 id=停用启用删除访问凭证>停用/启用/删除访问凭证</h2><ol><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，选择 【组织资源】-> 【访问凭证】，查看“访问凭证”列表。单击列表右侧【禁用】/【启用】/【删除】按钮。如下图所示：</p><blockquote><p>注意：点击【禁用】之后，【禁用】按钮就变成了【启用】</p></blockquote></li><li><p>单击【确认】按钮</p></li></ol><p><img src=../../../../../images/access-card.png alt></p></div><div class=td-content style=page-break-before:always><h1 id=pg-546cb0ff5126c40169ac9e848ea02681>4 - 监控与告警</h1><div class=lead>监控与告警</div><h1 id=监控与告警>监控与告警</h1></div><div class=td-content><h1 id=pg-79be2d16b5d7949b81dad31c17ccfb47>4.1 - 设置告警</h1><div class=lead>设置告警</div><h2 id=概念>概念</h2><p><strong>这里用户配置平台告警。</strong></p><h2 id=前提条件>前提条件</h2><blockquote><ul><li>需要设置告警的命名空间所在的集群，应该先在<a href=../../../platform-console/addon-mgmt/>【扩展组件】</a>安装<strong>Prometheus组件</strong></li></ul></blockquote><h2 id=操作步骤>操作步骤</h2><h3 id=新建告警设置>新建告警设置</h3><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择【监控&告警】-> 【告警设置】，查看“告警设置”列表。</li><li>选择相应【项目】和【namespace】，点击【新建】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BA%E5%91%8A%E8%AD%A6.png alt=&#x65B0;&#x5EFA;&#x544A;&#x8B66;></p><ul><li>在“新建策略”页面填写告警策略信息。如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BA%E5%91%8A%E8%AD%A6%E7%AD%96%E7%95%A5-1.png alt=&#x65B0;&#x5EFA;&#x544A;&#x8B66;&#x7B56;&#x7565;></p><ul><li><strong>告警策略名称：</strong> 输入告警策略名称，最长60字符</li><li><strong>策略类型：</strong> 选择告警策略应用类型<ul><li><strong>集群：</strong> 集群监控告警</li><li><strong>Pod：</strong> Pod 监控告警<ul><li><strong>告警对象：</strong> 选择Pod相关的告警对象，支持对namespace下不同对deployment、stateful和daemonset 进行监控报警<ul><li><strong>按工作负载选择：</strong> 选择namespace下的某个工作负载</li><li><strong>全部选择：</strong> 不区分namespace，全部监控</li></ul></li></ul></li><li><strong>节点：</strong> 节点监控告警</li></ul></li><li><strong>统计周期：</strong> 选择数据采集周期，支持1、2、3、4、5分钟</li><li><strong>指标：</strong> 选择告警指标，支持对监测值与指标值进行【大于/小于】比较，选择结果持续周期。如下图：</li></ul><p><img src=../../../../../images/%E6%8C%87%E6%A0%87%E8%AE%BE%E7%BD%AE.png alt=&#x6307;&#x6807;&#x8BBE;&#x7F6E;></p><ul><li><strong>接收组：</strong> 选择接收组，当出现满足条件当报警信息时，向组内人员发送消息。<strong>接收组需要先在</strong> <a href=../alerts#%E9%80%9A%E7%9F%A5%E8%AE%BE%E7%BD%AE><strong>通知设置</strong></a> <strong>创建</strong></li><li><strong>通知方式：</strong> 选择通知渠道和消息模版。<strong>通知渠道 和 消息模版需要先在</strong> <a href=../alerts#%E9%80%9A%E7%9F%A5%E8%AE%BE%E7%BD%AE><strong>通知设置</strong></a> <strong>创建</strong><ul><li><strong>添加通知方式</strong> 如需要添加多种通知方式，点击该按钮。<ol><li>单击【提交】按钮。</li></ol></li></ul></li></ul><h3 id=复制告警设置>复制告警设置</h3><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【告警设置】，查看告警设置列表。</li><li>选择相应【项目】和【namespace】，点击“告警设置”列表最右侧的【复制】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E5%91%8A%E8%AD%A6%E5%A4%8D%E5%88%B6%E6%8C%89%E9%92%AE-1.png alt=&#x544A;&#x8B66;&#x590D;&#x5236;&#x6309;&#x94AE;></p><ul><li><p>在复制策略页面，编辑告警策略信息。</p></li><li><p>单击【提交】按钮。</p><p><strong>编辑告警设置</strong></p></li><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，选择 【监控&告警】->【告警设置】，查看告警设置列表。</p></li><li><p>选择相应【项目】和【namespace】，点击【告警名称】。如下图所示：</p></li></ul><p><img src=../../../../../images/%E5%91%8A%E8%AD%A6%E5%90%8D%E7%A7%B0-1.png alt=&#x544A;&#x8B66;&#x540D;&#x79F0;></p><ul><li>在“告警策略详情”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E5%91%8A%E8%AD%A6%E7%BC%96%E8%BE%91-1.png alt=&#x544A;&#x8B66;&#x7F16;&#x8F91;></p><ul><li><p>在更新策略页面，编辑策略信息。</p></li><li><p>单击【提交】按钮。</p><p><strong>删除告警设置</strong></p></li><li><p>登录 TKEStack。</p></li><li><p>切换至 【业务管理】控制台，选择 【监控&告警】->【告警设置】，查看“告警设置”列表。</p></li><li><p>选择相应【项目】和【namespace】，点击列表最右侧的【删除】按钮。如下图所示：</p></li></ul><p><img src=../../../../../images/%E5%91%8A%E8%AD%A6%E5%88%A0%E9%99%A4-1.png alt=&#x544A;&#x8B66;&#x5220;&#x9664;></p><ul><li>在弹出的删除告警窗口，单击【确定】按钮。</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-845ad2011e5c3014b6adbbdc05f6c385>4.2 - 通知设置</h1><div class=lead>通知设置</div><h2 id=概念>概念</h2><p><strong>这里用户配置平台通知。</strong></p><h2 id=操作步骤>操作步骤</h2><p>这部分和【平台管理】控制台下【监控&告警】下的【通知设置】完全一致。故这里使用【平台管理】控制台下的截图。</p><h3 id=通知渠道>通知渠道</h3><h4 id=新建通知渠道>新建通知渠道</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知渠道】，查看“通知渠道”列表。</li><li>点击【新建】按钮。如下图所示：</li></ul><p><img src=../../../../../images/xin-jian-tong-zhi-qu-dao-an-niu-%20%283%29.png alt=&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6E20;&#x9053;&#x6309;&#x94AE;></p><ul><li>在“新建通知渠道”页面填写渠道信息。如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BA%E9%80%9A%E7%9F%A5%E6%B8%A0%E9%81%93%20%281%29.png alt=&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6E20;&#x9053;></p><ul><li><strong>名称：</strong> 填写渠道名称</li><li><strong>渠道：</strong> 选择渠道类型，输入渠道信息</li><li><strong>邮件：</strong> 邮件类型<ul><li><strong>email：</strong> 邮件发送放地址</li><li><strong>password：</strong> 邮件发送方密码</li><li><strong>smtpHost：</strong> smtp IP地址</li><li><strong>smtpPort：</strong> smtp端口</li><li><strong>tls：</strong> 是否tls加密</li></ul></li><li><strong>短信：</strong> 短信方式<ul><li><strong>appKey：</strong> 短信发送方的appKey</li><li><strong>sdkAppID：</strong> sdkAppID</li><li><strong>extend：</strong> extend 信息</li></ul></li><li><strong>微信公众号：</strong> 微信公众号方式<ul><li><strong>appID：</strong> 微信公众号appID</li><li><strong>appSecret：</strong> 微信公众号app密钥</li></ul></li><li>单击【保存】按钮。</li></ul><h4 id=编辑通知渠道>编辑通知渠道</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知渠道】，查看“通知渠道”列表。</li><li>单击渠道名称。如下图所示：</li></ul><p><img src=../../../../../images/qu-dao-ming-cheng-%20%281%29%20%282%29.png alt=&#x6E20;&#x9053;&#x540D;&#x79F0;></p><ul><li>在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%B8%A0%E9%81%93%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE%20%282%29%20%281%29.png alt=&#x6E20;&#x9053;&#x7F16;&#x8F91;&#x6309;&#x94AE;></p><ul><li>在“更新渠道通知”页面，编辑渠道信息。</li><li>单击【保存】按钮。</li></ul><h4 id=删除通知渠道>删除通知渠道</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知渠道】，查看“通知渠道”列表。</li><li>选择要删除的渠道，点击【删除】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%B8%A0%E9%81%93%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE%20%282%29%20%286%29.png alt=&#x5220;&#x9664;&#x6E20;&#x9053;></p><ul><li>单击删除窗口的【确定】按钮。</li></ul><h3 id=通知模板>通知模板</h3><h4 id=新建通知模版>新建通知模版</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知模板】，查看“通知模板”列表。</li><li>点击【新建】按钮。如下图所示：</li></ul><p><img src=../../../../../images/xin-jian-tong-zhi-mo-ban-%20%281%29.png alt=&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6A21;&#x7248;></p><ul><li>在“新建通知模版”页面填写模版信息。如下图所示：</li></ul><p><img src=../../../../../images/%E9%80%9A%E7%9F%A5%E6%A8%A1%E7%89%88.png alt=&#x901A;&#x77E5;&#x6A21;&#x7248;></p><ul><li><strong>名称：</strong> 模版名称</li><li><strong>渠道：</strong> 选择已创建的渠道</li><li><strong>body：</strong> 填写消息body体</li><li><strong>header：</strong> 填写消息标题</li><li>单击【保存】按钮。</li></ul><h4 id=编辑通知模版>编辑通知模版</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知模板】，查看“通知模板”列表。</li><li>单击模版名称。如下图所示：</li></ul><p><img src=../../../../../images/%E6%A8%A1%E7%89%88%E5%90%8D%E7%A7%B0%20%282%29.png alt=&#x6A21;&#x7248;&#x540D;&#x79F0;></p><ul><li>在基本信息页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%A8%A1%E7%89%88%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE%20%281%29%20%281%29.png alt=&#x6A21;&#x7248;&#x7F16;&#x8F91;&#x6309;&#x94AE;></p><ul><li>在“更新通知模版”页面，编辑模版信息。</li><li>单击【保存】按钮。</li></ul><h4 id=删除通知模版>删除通知模版</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【通知模板】，查看"通知模板"列表。</li><li>选择要删除的模版，点击【删除】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E5%88%A0%E9%99%A4%E6%A8%A1%E7%89%88%20%281%29.png alt=&#x5220;&#x9664;&#x6A21;&#x7248;></p><ul><li>单击删除窗口的【确定】按钮。</li></ul><h3 id=接收人>接收人</h3><h4 id=新建接收人>新建接收人</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收人】，查看"接收人"列表。</li><li>点击【新建】按钮。如下图所示：</li></ul><p><img src=../../../../../images/xin-jian-jie-shou-ren-%20%281%29.png alt=&#x65B0;&#x5EFA;&#x63A5;&#x6536;&#x4EBA;></p><ul><li>在“新建接收人”页面填写模版信息。如下图所示：</li></ul><p><img src=../../../../../images/%E6%8E%A5%E6%94%B6%E4%BA%BA%20%281%29%20%281%29.png alt=&#x63A5;&#x6536;&#x4EBA;></p><ul><li><strong>显示名称：</strong> 接收人显示名称</li><li><strong>用户名：</strong> 接收人用户名</li><li><strong>移动电话：</strong> 手机号</li><li><strong>电子邮件：</strong> 接收人邮箱</li><li><strong>微信OpenID：</strong> 接收人微信ID</li><li>单击【保存】按钮。</li></ul><h4 id=编辑接收人信息>编辑接收人信息</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收人】，查看“接收人”列表。</li><li>单击接收人名称。如下图所示：</li></ul><p><img src=../../../../../images/jie-shou-ren-ming-cheng-%20%281%29.png alt=&#x63A5;&#x6536;&#x4EBA;&#x540D;&#x79F0;></p><ul><li>在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%8E%A5%E6%94%B6%E4%BA%BA%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE.png alt=&#x63A5;&#x6536;&#x4EBA;&#x7F16;&#x8F91;&#x6309;&#x94AE;></p><ul><li>在“更新接收人”页面，编辑接收人信息。</li><li>单击【保存】按钮。</li></ul><h4 id=删除接收人>删除接收人</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收人】，查看“接收人”列表。</li><li>选择要删除的接收人，点击【删除】按钮。如下图所示：</li></ul><p><img src=../../../../../images/image%20%28135%29.png alt></p><ul><li>单击删除窗口的【确定】按钮。</li></ul><h3 id=接收组>接收组</h3><h4 id=新建接收组>新建接收组</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收组】，查看“接收组”列表。</li><li>点击【新建】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BA%E6%8E%A5%E6%94%B6%E7%BB%84%20%282%29%20%285%29.png alt=&#x65B0;&#x5EFA;&#x63A5;&#x6536;&#x7EC4;></p><ul><li>在“新建接收组”页面填写模版信息。如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BA%E6%8E%A5%E6%94%B6%E7%BB%84%20%282%29.png alt=&#x63A5;&#x6536;&#x7EC4;></p><ul><li><strong>名称：</strong> 接收组显示名称</li><li><strong>接收组：</strong> 从列表里选择接收人。如没有想要的接收人，请在<a href=../notifier#%E6%8E%A5%E6%94%B6%E4%BA%BA>接收人</a>里创建。</li><li>单击【保存】按钮。</li></ul><h4 id=编辑接收组信息>编辑接收组信息</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收组】，查看“接收组”列表。</li><li>单击接收组名称。如下图所示：</li></ul><p><img src=../../../../../images/jie-shou-zu-ming-cheng-%20%281%29.png alt=&#x63A5;&#x6536;&#x7EC4;&#x540D;&#x79F0;></p><ul><li>在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E6%8E%A5%E6%94%B6%E7%BB%84%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE%20%281%29.png alt=&#x63A5;&#x6536;&#x7EC4;&#x7F16;&#x8F91;&#x6309;&#x94AE;></p><ul><li>在“更新接收组”页面，编辑接收组信息。</li><li>单击【保存】按钮。</li></ul><h4 id=删除接收组>删除接收组</h4><ul><li>登录 TKEStack。</li><li>切换至【业务管理】控制台，选择 【监控&告警】->【通知设置】->【接收组】，查看“接收组”列表。</li><li>选择要删除的接收组，点击【删除】按钮。如下图所示：</li></ul><p><img src=../../../../../images/%E5%88%A0%E9%99%A4%E6%8E%A5%E6%94%B6%E7%BB%84%20%281%29%20%281%29.png alt=&#x5220;&#x9664;&#x63A5;&#x6536;&#x7EC4;></p><ul><li>单击删除窗口的【确定】按钮。</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-22fc8e15cadbee096a9ba8d919957ba0>5 - 运维中心</h1><div class=lead>运维中心</div><h1 id=运维中心>运维中心</h1></div><div class=td-content><h1 id=pg-55a60e4dfe4f04261ba0510de35132f8>5.1 - Helm应用</h1><div class=lead>Helm应用</div><p>应用功能是 TKEStack 集成的 <a href=https://helm.sh/>Helm 3.0</a> 相关功能，为您提供创建 helm chart、容器镜像、软件服务等各种产品和服务的能力。已创建的应用将在您指定的集群中运行，为您带来相应的能力。</p><h2 id=新建-helm-应用>新建 Helm 应用</h2><ul><li>登录 TKEStack</li><li>切换至【平台管理】控制台，选择【运维中心】->【 Helm 应用】</li><li>选择相应【集群】，单击【新建】按钮，如下图所示：</li></ul><p><img src=../../../../../images/platformhelm.png alt="&#x65B0;&#x5EFA; Helm &#x6309;&#x94AE;"></p><ul><li>在“新建 Helm 应用”页面填写Helm应用信息，如下图所示：</li></ul><p><img src=../../../../../images/%E6%96%B0%E5%BB%BAHelm%E5%BA%94%E7%94%A8.png alt="&#x65B0;&#x5EFA; Helm &#x5E94;&#x7528;"></p><ul><li><strong>应用名称：</strong> 输入应用名，1～63字符，只能包含小写字母、数字及分隔符("-")，且必须以小写字母开头，数字或小写字母结尾</li><li><strong>运行集群：</strong> 选择应用所在集群</li><li><strong>命名空间：</strong> 选择应用所在集群的命名空间</li><li><strong>类型：</strong> 当前仅支持 HelmV3</li><li><strong>Chart：</strong> 选择需要部署的 chart</li><li><strong>Chart版本：</strong> 选择 chart 的版本</li><li><strong>参数：</strong> 更新时如果选择不同版本的 Helm Chart，参数设置将被覆盖</li><li><strong>拟运行：</strong> 会返回模板渲染清单，即最终将部署到集群的 YAML 资源，不会真正执行安装</li><li>单击【完成】按钮</li></ul><h2 id=删除-helm-应用>删除 Helm 应用</h2><ol><li>登录 TKEStack</li><li>切换至【平台管理】控制台，选择【运维中心】->【 Helm 应用】</li><li>点击【删除】</li></ol><p><img src=../../../../../images/image-20201203150729694.png alt=image-20201203150729694></p><h2 id=查看-helm-应用资源列表>查看 Helm 应用资源列表</h2><ol><li>登录 TKEStack</li><li>切换至【平台管理】控制台，选择【运维中心】->【 Helm 应用】</li><li>点击【应用名】后，点击【资源列表】，可查看该应用所有 Kubernetes 资源对象</li></ol><h2 id=查看-helm-应用详情>查看 Helm 应用详情</h2><ol><li>登录 TKEStack</li><li>切换至【平台管理】控制台，选择【运维中心】->【 Helm 应用】</li><li>点击【应用名】后，点击【应用详情】</li></ol><p><img src=../../../../../images/image-20201203150904452.png alt=image-20201203150904452></p><h2 id=查看-helm-应用版本历史>查看 Helm 应用版本历史</h2><ol><li>登录 TKEStack</li><li>切换至【平台管理】控制台，选择【运维中心】->【 Helm 应用】</li><li>点击【应用名】后，点击【版本历史】，可查看该应用所部署的历史版本。可以通过选择不同的版本进行参数对比查看其版本区别</li></ol><p><img src=../../../../../images/image-20201203151027616.png alt=image-20201203151027616></p></div><div class=td-content style=page-break-before:always><h1 id=pg-aecfc90660f6fc8ff8c08c88ca759f90>5.2 - 日志采集</h1><div class=lead>日志采集</div><p>TKESTack 提供的集群内日志采集功能，支持将集群内服务或集群节点特定路径文件的日志发送至 Kafka、Elasticsearch 等消费端，支持采集容器标准输出日志，容器内文件日志以及主机内文件日志。更提供事件持久化、审计等功能，实时记录集群事件及操作日志记录，帮助运维人员存储和分析集群内部资源生命周期、资源调度、异常告警等情况</p><p><img src=../../../../../images/image%20%2818%29.png alt></p><p>日志收集功能需要为每个集群手动开启。日志收集功能开启后，日志收集组件 logagent 会在集群内以 Daemonset 的形式运行。用户可以通过日志收集规则配置日志的采集源和消费端，日志收集 Agent 会从用户配置的采集源进行日志收集，并将日志内容发送至用户指定的消费端。需要注意的是，<strong>使用日志收集功能需要您确认 Kubernetes 集群内节点能够访问日志消费端。</strong></p><ul><li><strong>采集容器标准输出日志</strong> ：采集集群内指定<strong>容器的 Stderr 和 Stdout 日志。</strong>，采集到的日志信息将会以 JSON 格式输出到用户指定的消费端，并会自动附加相关的 Kubernetes metadata， 包括容器所属 Pod 的 label 和 annotation 等信息。</li><li><strong>采集容器内文件日志</strong> ：采集集群内指定<strong>容器内文件路径的日志</strong>，用户可以根据自己的需求，灵活的配置所需的容器和路径，采集到的日志信息将会以 JSON 格式输出到用户指定的消费端， 并会附加相关的 Kubernetes metadata，包括容器所属 pod 的 label 和 annotation 等信息。</li><li><strong>采集主机内文件日志</strong> ：采集集群内所有节点的指定<strong>主机文件路径的日志</strong>，logagent 会采集集群内所有节点上满足指定路径规则的文件日志，以 JSON 格式输出到用户指定的输出端， 并会附加用户指定的 metadata，包括日志来源文件的路径和用户自定义的 metadata。</li></ul><blockquote><p>注意：日志采集对接外部 Kafka 或 Elasticsearch，该功能需要额外开启，位置在集群 <a href=https://github.com/tkestack/tke/blob/master/docs/guide/zh-CN/products/platform/cluster.md#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF>基本信息</a> 下面，点击开启“日志采集”服务</p></blockquote><p><img src=../../../../../images/image%20%28100%29.png alt></p><h3 id=使用日志采集服务>使用日志采集服务</h3><h4 id=业务管理侧>业务管理侧</h4><ul><li>登录 TKEStack</li><li>切换至【业务管理】控制台，选择 【运维中心】->【日志采集】</li><li>选择相应【业务】和【命名空间】，单击【新建】按钮，如下图所示：</li></ul><p><img src=../../../../../images/image%20%2825%29.png alt></p><ul><li>在“新建日志采集”页面填写日志采集信息，如下图所示：</li></ul><p><img src=../../../../../images/image%20%28130%29.png alt></p><ul><li><strong>收集规则名称：</strong> 输入规则名，1～63字符，只能包含小写字母、数字及分隔符("-")，且必须以小写字母开头，数字或小写字母结尾</li><li><strong>业务：</strong> 选择所属业务（业务管理侧才会出现）</li><li><strong>集群：</strong> 选择所属集群（平台管理侧才会出现）</li><li><strong>类型：</strong> 选择采集类型<ul><li><strong>容器标准输出：</strong> 容器 Stderr 和 Stdout 日志信息采集<ul><li><strong>日志源：</strong> 可以选择所有容器或者某个 Namespace 下的所有容器/工作负载<ul><li><strong>所有容器：</strong> 所有容器</li><li><strong>指定容器：</strong> 某个 Namespace 下的所有容器或者工作负载</li></ul></li></ul></li><li><strong>容器文件路径：</strong> 容器内文件内容采集<ul><li><p><strong>日志源：</strong> 可以采集具体容器内的某个文件路径下的文件内容</p><ul><li><strong>工作负载选项：</strong> 选择某个 Namespace 下的某种工作负载类型下的某个工作负载</li><li><strong>配置采集路径：</strong> 选择某个容器下的某个文件路径</li></ul><blockquote><ul><li>文件路径若输入<code>stdout</code>，则转为容器标准输出模式</li><li>可配置多个路径。路径必须以<code>/</code>开头和结尾，文件名支持通配符（*）。文件路径和文件名最长支持63个字符</li><li>请保证容器的日志文件保存在数据卷，否则收集规则无法生效，详见<a href=https://github.com/tkestack/tke/blob/master/docs/guide/zh-CN/products/business-control-pannel/operation/logcollect.md#%E6%8C%87%E5%AE%9A%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E5%90%8E%E7%9A%84%E6%97%A5%E5%BF%97%E7%9B%AE%E5%BD%95>指定容器运行后的日志目录</a></li></ul></blockquote></li></ul></li><li><strong>节点文件路径：</strong> 收集节点上某个路径下的文件内容<ul><li><strong>日志源：</strong> 可以采集具体节点内的某个文件路径下的文件内容<ul><li><strong>收集路径：</strong> 节点上日志收集路径。路径必须以<code>/</code>开头和结尾，文件名支持通配符（*）。文件路径和文件名最长支持63个字符</li></ul></li><li><strong>metadata：</strong> key：value 格式，收集的日志会带上 metadata 信息上报给消费端</li></ul></li></ul></li><li><strong>消费端：</strong> 选择日志消费端<ul><li><strong>Kafka：</strong><ul><li><strong>访问地址：</strong> Kafka IP 和端口</li><li><strong>主题（Topic）：</strong> Kafka Topic 名</li></ul></li><li><strong>Elasticsearch：</strong><ul><li><p><strong>Elasticsearch 地址：</strong> ES 地址，如：<a href=http://190.0.0.1:200/>http://190.0.0.1:200</a></p><blockquote><p>注意：当前只支持未开启用户登录认证的 ES 集群</p></blockquote></li><li><p><strong>索引：</strong> ES索引，最长60个字符，只能包含小写字母、数字及分隔符("-"、"_"、"+")，且必须以小写字母开头</p></li></ul></li></ul></li><li>单击【完成】按钮</li></ul><h4 id=平台管理侧>平台管理侧</h4><p>在平台管理侧也支持日志采集规则的创建，创建方式和业务管理处相同。详情可点击平台侧的<a href=https://github.com/tkestack/tke/blob/master/docs/guide/zh-CN/products/platform/operation/log.md>日志采集</a>。</p><h3 id=指定容器运行后的日志目录>指定容器运行后的日志目录</h3><p>LogAgent 除了支持日志规则的创建，也支持指定容器运行后的日志目录，可实现日志文件展示和下载。</p><blockquote><p>前提：需要在创建负载时挂载数据卷，并指定日志目</p></blockquote><p><img src=../../../../../images/image%20%2878%29.png alt></p><p>创建负载以后，在容器内的<code>/data/logdir</code>目录下的所有文件可以展示并下载，例如我们在容器的<code>/data/logdir</code>下新建一个名为<code>a.log</code>的文件，如果有内容的话，也可以在这里展示与下载</p><p><img src=../../../../../images/image%20%28143%29.png alt></p></div><div class=td-content style=page-break-before:always><h1 id=pg-08c4350de537017097f922dfdd8dceaf>6 -</h1><h1 id=helm应用>Helm应用</h1><h2 id=概念>概念</h2><p><strong>这里业务端用户可以管理通过 helm 创建的应用。</strong></p><h3 id=操作步骤>操作步骤</h3><h4 id=新建helm应用>新建Helm应用</h4><ol><li>登录 TKEStack。</li><li>切换至 【业务管理】控制台，选择【 Helm应用】。</li><li>选择相应【业务】和【namespace】，单击【新建】按钮。如下图所示：</li><li>在“新建Helm应用”页面填写Helm应用信息。如下图所示：</li></ol><ul><li><strong>应用名：</strong> 输入应用名，1～63字符，只能包含小写字母、数字及分隔符("-")，且必须以小写字母开头，数字或小写字母结尾</li><li><strong>命名空间：</strong> 选择该应用运行的命名空间</li><li><strong>Chart_Url：</strong> 输入Chart 文件地址</li><li><strong>类型：</strong> 选择应用类型</li><li><strong>公有：</strong> 公有类型</li><li><strong>私有：</strong> 私有类型<ul><li><strong>用户名：</strong> 私有用户名</li><li><strong>密码：</strong> 私有密码</li></ul></li><li><strong>Key-Value：</strong> 通过Key-Value替换Chart包中默认配置。</li></ul><ol><li>单击【完成】按钮。</li></ol><p><img src=../../images/xin-jian-helm.png alt></p><p><img src=../../images/xin-jian-helm-ying-yong-.png alt></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>